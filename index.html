<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ - Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <style>
        /* ====================================================
           Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙˆØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù…
        ==================================================== */
        * { 
            box-sizing: border-box; 
            font-weight: bold !important; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            direction: rtl; 
            background-color: #e6f7ff; /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù„Ø¨Ù†ÙŠ */ 
            color: #2c3e50; 
            font-weight: bold; 
            line-height: 1.6; 
        }
        
        /* ====================================================
           Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        ==================================================== */
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 20px;
        }
        
        .login-box { 
            background: white; 
            padding: 40px 30px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 450px; 
            text-align: center; 
        }
        
        .login-title { 
            font-size: 26px; 
            margin-bottom: 10px; 
            color: #2c3e50; 
            font-weight: bold; 
        }
        
        .login-subtitle { 
            color: #7f8c8d; 
            margin-bottom: 30px; 
            font-size: 14px; 
        }
        
        .country-selector { 
            width: 100%; 
            padding: 14px; 
            margin-bottom: 20px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 16px; 
            background-color: #f8fafc; 
            font-weight: bold; 
            color: #2c3e50; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .phone-input-container { 
            display: flex; 
            margin-bottom: 20px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            overflow: hidden; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .country-code { 
            background-color: #f1f5f9; 
            padding: 14px 15px; 
            color: #475569; 
            border-right: 2px solid #e0e6ed; 
            font-weight: bold; 
            min-width: 100px; 
        }
        
        .phone-input { 
            flex: 1; 
            border: none; 
            padding: 14px; 
            font-size: 16px; 
            background-color: #f8fafc; 
            font-weight: bold; 
            color: #2c3e50; 
        }
        
        .phone-input:focus { 
            outline: none; 
        }
        
        .phone-status { 
            padding: 12px; 
            margin-bottom: 20px; 
            border-radius: 10px; 
            font-size: 14px; 
            display: none; 
        }
        
        .phone-status.registered { 
            background-color: #d1fae5; 
            color: #065f46; 
            border: 1px solid #a7f3d0; 
        }
        
        .phone-status.new { 
            background-color: #dbeafe; 
            color: #1e40af; 
            border: 1px solid #bfdbfe; 
        }
        
        .otp-method-selector { 
            display: none; 
            margin-bottom: 20px; 
        }
        
        .otp-method-title { 
            font-size: 14px; 
            color: #475569; 
            margin-bottom: 10px; 
            text-align: right; 
            font-weight: bold; 
        }
        
        .otp-methods { 
            display: flex; 
            gap: 10px; 
        }
        
        .otp-method-btn { 
            flex: 1; 
            padding: 14px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            background: white; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            box-shadow: 2px 2px 5px #d1d9e6, -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .otp-method-btn:hover { 
            border-color: #3b82f6; 
        }
        
        .otp-method-btn.active { 
            border-color: #3b82f6; 
            background-color: #eff6ff; 
            color: #1d4ed8; 
        }
        
        .otp-method-btn.disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            background-color: #f8fafc; 
            color: #94a3b8; 
            border-color: #e0e6ed; 
        }
        
        .otp-input-container { 
            display: none; 
        }
        
        .otp-input-title { 
            font-size: 14px; 
            color: #475569; 
            margin-bottom: 10px; 
            text-align: right; 
            font-weight: bold; 
        }
        
        .otp-input { 
            width: 100%; 
            padding: 14px; 
            margin-bottom: 15px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 18px; 
            text-align: center; 
            letter-spacing: 8px; 
            font-weight: bold; 
            background-color: #f8fafc; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .otp-error { 
            color: #dc2626; 
            font-size: 13px; 
            margin-bottom: 15px; 
            display: none; 
            font-weight: bold; 
        }
        
        .otp-resend { 
            font-size: 13px; 
            color: #475569; 
            margin-bottom: 20px; 
            font-weight: bold; 
        }
        
        .otp-resend a { 
            color: #3b82f6; 
            text-decoration: none; 
            font-weight: bold; 
            cursor: pointer; 
        }
        
        .login-btn { 
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            box-shadow: 2px 2px 5px #d1d9e6, -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .login-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); 
        }
        
        .login-btn:disabled { 
            background: #94a3b8; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        
        .back-btn { 
            background: none; 
            border: none; 
            color: #64748b; 
            margin-top: 20px; 
            cursor: pointer; 
            font-size: 14px; 
            display: inline-flex; 
            align-items: center; 
            gap: 5px; 
            font-weight: bold; 
        }
        
        /* ====================================================
           Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        ==================================================== */
        .sync-progress-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 4px; 
            background-color: #f1f5f9; 
            z-index: 9999; 
            display: none; 
        }
        
        .sync-progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981); 
            width: 0%; 
            transition: width 0.3s ease; 
            border-radius: 0 2px 2px 0; 
        }
        
        .sync-status-indicator { 
            position: fixed; 
            top: 10px; 
            left: 10px; 
            background: white; 
            padding: 5px 10px; 
            border-radius: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            font-size: 12px; 
            z-index: 9998; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            opacity: 0; 
            transition: opacity 0.3s; 
        }
        
        .sync-status-indicator.show { 
            opacity: 1; 
        }
        
        .sync-status-indicator.syncing { 
            color: #3b82f6; 
        }
        
        .sync-status-indicator.success { 
            color: #10b981; 
        }
        
        .sync-status-indicator.error { 
            color: #ef4444; 
        }
        
        /* ====================================================
           Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        ==================================================== */
        .app-container { 
            display: none; 
            min-height: 100vh; 
        }
        
        .app-header { 
            background: white; 
            padding: 0 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        
        .header-tabs { 
            display: flex; 
            border-bottom: 2px solid #f1f5f9; 
        }
        
        .header-tab { 
            padding: 18px 25px; 
            background: none; 
            border: none; 
            font-size: 14px; 
            color: #64748b; 
            cursor: pointer; 
            position: relative; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        
        .header-tab.active { 
            color: #3b82f6; 
        }
        
        .header-tab.active::after { 
            content: ''; 
            position: absolute; 
            bottom: -2px; 
            left: 0; 
            right: 0; 
            height: 3px; 
            background-color: #3b82f6; 
            border-radius: 3px 3px 0 0; 
        }
        
        .tab-badge { 
            background-color: #ef4444; 
            color: white; 
            font-size: 10px; 
            padding: 2px 6px; 
            border-radius: 10px; 
            margin-right: 5px; 
            display: inline-block; 
            min-width: 18px; 
            text-align: center; 
        }
        
        .header-actions { 
            padding: 15px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background-color: #f8fafc; 
        }
        
        .user-info { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .user-avatar { 
            width: 40px; 
            height: 40px; 
            background: linear-gradient(135deg, #3b82f6, #8b5cf6); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 18px; 
        }
        
        .user-details { 
            display: flex; 
            flex-direction: column; 
        }
        
        .user-name { 
            font-size: 14px; 
            color: #2c3e50; 
        }
        
        .user-phone { 
            font-size: 12px; 
            color: #64748b; 
        }
        
        .header-controls { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .control-btn { 
            background: white; 
            border: 2px solid #e0e6ed; 
            border-radius: 8px; 
            padding: 8px 12px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            font-size: 13px; 
            color: #475569; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        
        .control-btn:hover { 
            border-color: #3b82f6; 
            color: #3b82f6; 
        }
        
        .control-btn.sync-btn { 
            background-color: #eff6ff; 
            border-color: #bfdbfe; 
            color: #1d4ed8; 
        }
        
        .control-btn.chat-btn { 
            background-color: #f0f9ff; 
            border-color: #bae6fd; 
            color: #0369a1; 
        }
        
        .control-btn.accounts-btn { 
            background-color: #f0fdf4; 
            border-color: #bbf7d0; 
            color: #15803d; 
        }
        
        .control-btn.logout-btn { 
            background-color: #fef2f2; 
            border-color: #fecaca; 
            color: #dc2626; 
        }
        
        /* ====================================================
           Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        ==================================================== */
        .tab-content { 
            display: none; 
            padding: 20px; 
            animation: fadeIn 0.3s ease; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        /* ====================================================
           ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠ
        ==================================================== */
        .transaction-form { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            margin-bottom: 20px; 
        }
        
        .form-row { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 15px; 
        }
        
        .form-group { 
            flex: 1; 
        }
        
        .form-label { 
            display: block; 
            margin-bottom: 8px; 
            font-size: 13px; 
            color: #475569; 
            font-weight: bold; 
        }
        
        .form-input, .form-select { 
            width: 100%; 
            padding: 12px 15px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 14px; 
            background-color: #f8fafc; 
            font-weight: bold; 
            transition: all 0.3s; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .form-input:focus, .form-select:focus { 
            outline: none; 
            border-color: #3b82f6; 
            background-color: white; 
        }
        
        .amount-inputs { 
            display: flex; 
            gap: 15px; 
        }
        
        .amount-input { 
            flex: 1; 
        }
        
        .amount-input.credit input { 
            border-color: #10b981; 
            background-color: #f0fdf4; 
        }
        
        .amount-input.debit input { 
            border-color: #ef4444; 
            background-color: #fef2f2; 
        }
        
        .form-actions { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px; 
        }
        
        .primary-btn { 
            flex: 1; 
            padding: 14px; 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 15px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
        }
        
        .primary-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); 
        }
        
        .secondary-btn { 
            flex: 1; 
            padding: 14px; 
            background: #f1f5f9; 
            color: #475569; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 15px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
        }
        
        .secondary-btn:hover { 
            background: #e0e6ed; 
        }
        
        .transaction-summary { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            margin-bottom: 20px; 
        }
        
        .summary-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
        }
        
        .summary-card { 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
        }
        
        .summary-card.total-credit { 
            background: linear-gradient(135deg, #d1fae5, #a7f3d0); 
            color: #065f46; 
        }
        
        .summary-card.total-debit { 
            background: linear-gradient(135deg, #fee2e2, #fecaca); 
            color: #991b1b; 
        }
        
        .summary-card.balance { 
            background: linear-gradient(135deg, #dbeafe, #bfdbfe); 
            color: #1e40af; 
        }
        
        .summary-card-title { 
            font-size: 14px; 
            margin-bottom: 10px; 
            font-weight: bold; 
        }
        
        .summary-card-value { 
            font-size: 24px; 
            font-weight: bold; 
        }
        
        .transactions-table-container { 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            overflow: hidden; 
        }
        
        .table-header { 
            padding: 20px; 
            border-bottom: 2px solid #f1f5f9; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .table-title { 
            font-size: 16px; 
            color: #2c3e50; 
        }
        
        .table-controls { 
            display: flex; 
            gap: 10px; 
        }
        
        .search-box { 
            position: relative; 
            min-width: 250px; 
        }
        
        .search-input { 
            width: 100%; 
            padding: 10px 15px 10px 40px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 14px; 
            background-color: #f8fafc; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .search-icon { 
            position: absolute; 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: #94a3b8; 
        }
        
        .transactions-table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        
        .transactions-table th { 
            background-color: #f8fafc; 
            padding: 15px; 
            text-align: right; 
            color: #475569; 
            font-size: 12px; 
            border-bottom: 2px solid #e0e6ed; 
            white-space: nowrap; 
            font-weight: bold; 
        }
        
        .transactions-table td { 
            padding: 12px 15px; 
            border-bottom: 1px solid #f1f5f9; 
            font-size: 12px; 
            font-weight: bold; 
        }
        
        .transactions-table tbody tr:hover { 
            background-color: #f8fafc; 
        }
        
        .transaction-type { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 6px; 
            font-size: 10px; 
            font-weight: bold; 
        }
        
        .transaction-type.credit { 
            background-color: #d1fae5; 
            color: #065f46; 
        }
        
        .transaction-type.debit { 
            background-color: #fee2e2; 
            color: #991b1b; 
        }
        
        .transaction-actions { 
            display: flex; 
            gap: 5px; 
        }
        
        .action-btn { 
            padding: 6px 10px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            transition: all 0.3s; 
            font-weight: bold; 
        }
        
        .action-btn.edit-btn { 
            background-color: #fef3c7; 
            color: #92400e; 
        }
        
        .action-btn.delete-btn { 
            background-color: #fee2e2; 
            color: #991b1b; 
        }
        
        .action-btn.chat-btn { 
            background-color: #e0e7ff; 
            color: #3730a3; 
        }
        
        .action-btn:hover { 
            opacity: 0.9; 
            transform: translateY(-2px); 
        }
        
        /* ====================================================
           ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        ==================================================== */
        .chats-container { 
            display: flex; 
            height: calc(100vh - 180px); 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            overflow: hidden; 
        }
        
        .chats-sidebar { 
            width: 350px; 
            border-left: 1px solid #e0e6ed; 
            display: flex; 
            flex-direction: column; 
        }
        
        .chats-list { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
        }
        
        .chat-item { 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 10px; 
            cursor: pointer; 
            transition: all 0.3s; 
            border: 2px solid transparent; 
        }
        
        .chat-item:hover { 
            background-color: #f8fafc; 
        }
        
        .chat-item.active { 
            background-color: #eff6ff; 
            border-color: #3b82f6; 
        }
        
        .chat-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
        }
        
        .chat-name { 
            font-size: 14px; 
            color: #2c3e50; 
        }
        
        .chat-status { 
            font-size: 11px; 
            padding: 3px 8px; 
            border-radius: 12px; 
        }
        
        .chat-status.online { 
            background-color: #d1fae5; 
            color: #065f46; 
        }
        
        .chat-status.offline { 
            background-color: #f1f5f9; 
            color: #64748b; 
        }
        
        .chat-last-message { 
            font-size: 12px; 
            color: #64748b; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
        
        .chat-messages { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            background-color: #fafafa; 
        }
        
        .message { 
            margin-bottom: 15px; 
            max-width: 70%; 
            animation: messageIn 0.3s ease; 
        }
        
        @keyframes messageIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .message.sent { 
            margin-right: auto; 
        }
        
        .message.received { 
            margin-left: auto; 
        }
        
        .message-bubble { 
            padding: 12px 15px; 
            border-radius: 18px; 
            position: relative; 
            font-size: 13px; 
        }
        
        .message.sent .message-bubble { 
            background-color: #3b82f6; 
            color: white; 
            border-radius: 18px 18px 0 18px; 
        }
        
        .message.received .message-bubble { 
            background-color: white; 
            color: #2c3e50; 
            border: 1px solid #e0e6ed; 
            border-radius: 18px 18px 18px 0; 
        }
        
        .message.sent.transaction .message-bubble { 
            background-color: #10b981; 
        }
        
        .message.received.transaction .message-bubble { 
            background-color: #f0fdf4; 
            border-color: #a7f3d0; 
        }
        
        .message-time { 
            font-size: 10px; 
            color: #94a3b8; 
            margin-top: 5px; 
            text-align: right; 
        }
        
        .message.received .message-time { 
            text-align: left; 
        }
        
        .transaction-details { 
            margin-top: 10px; 
            padding: 10px; 
            background: rgba(255,255,255,0.2); 
            border-radius: 10px; 
        }
        
        .transaction-details.received { 
            background: #f8fafc; 
        }
        
        .chat-input-container { 
            padding: 20px; 
            border-top: 1px solid #e0e6ed; 
            background: white; 
        }
        
        .chat-input-row { 
            display: flex; 
            gap: 10px; 
        }
        
        .chat-input { 
            flex: 1; 
            padding: 12px 15px; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            font-size: 14px; 
            font-weight: bold; 
            resize: none; 
            min-height: 50px; 
            max-height: 100px; 
            box-shadow: inset 2px 2px 5px #d1d9e6, inset -2px -2px 5px #ffffff; /* ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        }
        
        .chat-input:focus { 
            outline: none; 
            border-color: #3b82f6; 
        }
        
        .send-btn { 
            padding: 12px 20px; 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: all 0.3s; 
        }
        
        .send-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); 
        }
        
        /* ====================================================
           ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª
        ==================================================== */
        .contacts-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        
        .contact-card { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            transition: all 0.3s; 
        }
        
        .contact-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
        }
        
        .contact-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        .contact-name { 
            font-size: 16px; 
            color: #2c3e50; 
        }
        
        .contact-code { 
            font-size: 11px; 
            color: #64748b; 
            background-color: #f1f5f9; 
            padding: 3px 8px; 
            border-radius: 10px; 
            cursor: pointer; 
            user-select: all; 
        }
        
        .contact-details { 
            margin-bottom: 15px; 
        }
        
        .contact-detail { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 8px; 
            font-size: 13px; 
        }
        
        .contact-detail-label { 
            color: #64748b; 
        }
        
        .contact-detail-value { 
            color: #2c3e50; 
        }
        
        .contact-balance { 
            padding: 10px; 
            background: #f8fafc; 
            border-radius: 10px; 
            margin-bottom: 15px; 
        }
        
        .balance-row { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 5px; 
        }
        
        .balance-label { 
            font-size: 12px; 
            color: #64748b; 
        }
        
        .balance-value { 
            font-size: 13px; 
            font-weight: bold; 
        }
        
        .balance-value.positive { 
            color: #10b981; 
        }
        
        .balance-value.negative { 
            color: #ef4444; 
        }
        
        .contact-actions { 
            display: flex; 
            gap: 10px; 
        }
        
        /* ====================================================
           ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        ==================================================== */
        .stats-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        
        .stat-card { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        
        .stat-title { 
            font-size: 14px; 
            color: #64748b; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-weight: bold; 
        }
        
        .stat-value { 
            font-size: 28px; 
            color: #2c3e50; 
            margin-bottom: 15px; 
        }
        
        .stat-chart { 
            height: 200px; 
            margin-top: 20px; 
        }
        
        /* ====================================================
           Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø± ÙˆØ§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        ==================================================== */
        .modal-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: rgba(0,0,0,0.5); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            animation: fadeIn 0.3s ease; 
        }
        
        .modal-overlay.active { 
            display: flex; 
        }
        
        .modal { 
            background: white; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 500px; 
            max-height: 90vh; 
            overflow-y: auto; 
            animation: modalIn 0.3s ease; 
        }
        
        @keyframes modalIn { 
            from { opacity: 0; transform: translateY(-20px) scale(0.95); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        
        .modal-header { 
            padding: 25px 25px 15px; 
            border-bottom: 2px solid #f1f5f9; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .modal-title { 
            font-size: 18px; 
            color: #2c3e50; 
        }
        
        .modal-close { 
            background: none; 
            border: none; 
            font-size: 20px; 
            color: #94a3b8; 
            cursor: pointer; 
            padding: 5px; 
            border-radius: 8px; 
        }
        
        .modal-close:hover { 
            background-color: #f1f5f9; 
        }
        
        .modal-body { 
            padding: 25px; 
        }
        
        .modal-footer { 
            padding: 15px 25px 25px; 
            border-top: 2px solid #f1f5f9; 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
        }
        
        /* ====================================================
           ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨
        ==================================================== */
        .account-switcher { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        .account-switch-btn { 
            flex: 1; 
            padding: 15px; 
            background: #f8fafc; 
            border: 2px solid #e0e6ed; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        
        .account-switch-btn.active { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            border-color: #3b82f6; 
        }
        
        .account-report { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        
        .report-period { 
            font-size: 14px; 
            color: #64748b; 
            margin-bottom: 20px; 
            text-align: center; 
        }
        
        .report-summary { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        
        .report-item { 
            text-align: center; 
            padding: 15px; 
            border-radius: 10px; 
            background-color: #f8fafc; 
        }
        
        .report-item-title { 
            font-size: 12px; 
            color: #64748b; 
            margin-bottom: 8px; 
        }
        
        .report-item-value { 
            font-size: 18px; 
            color: #2c3e50; 
            font-weight: bold; 
        }
        
        .report-transactions { 
            margin-top: 25px; 
        }
        
        /* ====================================================
           ØµÙØ­Ø© Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        ==================================================== */
        .about-container { 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            max-width: 800px; 
            margin: 0 auto; 
            text-align: center; 
        }
        
        .app-logo { 
            font-size: 48px; 
            color: #3b82f6; 
            margin-bottom: 20px; 
        }
        
        .app-name { 
            font-size: 32px; 
            color: #2c3e50; 
            margin-bottom: 10px; 
        }
        
        .app-description { 
            font-size: 16px; 
            color: #64748b; 
            margin-bottom: 30px; 
            line-height: 1.8; 
        }
        
        .developer-info { 
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe); 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 30px; 
        }
        
        .developer-name { 
            font-size: 20px; 
            color: #0369a1; 
            margin-bottom: 10px; 
        }
        
        .developer-contact { 
            font-size: 16px; 
            color: #0c4a6e; 
        }
        
        .app-features { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        
        .feature-item { 
            padding: 20px; 
            background-color: #f8fafc; 
            border-radius: 10px; 
            text-align: center; 
        }
        
        .feature-icon { 
            font-size: 24px; 
            color: #3b82f6; 
            margin-bottom: 15px; 
        }
        
        .feature-title { 
            font-size: 16px; 
            color: #2c3e50; 
            margin-bottom: 10px; 
        }
        
        .feature-description { 
            font-size: 13px; 
            color: #64748b; 
        }
        
        /* ====================================================
           Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡
        ==================================================== */
        .loading-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: rgba(0,0,0,0.8); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            z-index: 9999; 
            flex-direction: column; 
        }
        
        .loading-overlay.active { 
            display: flex; 
        }
        
        .loading-spinner { 
            width: 50px; 
            height: 50px; 
            border: 5px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            border-top-color: #3b82f6; 
            animation: spin 1s linear infinite; 
            margin-bottom: 20px; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .loading-text { 
            color: white; 
            font-size: 16px; 
        }
        
        .toast-container { 
            position: fixed; 
            top: 20px; 
            left: 20px; 
            right: 20px; 
            z-index: 9998; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            align-items: center; 
        }
        
        .toast { 
            background: white; 
            padding: 15px 20px; 
            border-radius: 10px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            max-width: 400px; 
            width: 100%; 
            animation: toastIn 0.3s ease; 
            transform-origin: top center; 
        }
        
        @keyframes toastIn { 
            from { opacity: 0; transform: translateY(-20px) scale(0.9); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        
        .toast.hiding { 
            animation: toastOut 0.3s ease forwards; 
        }
        
        @keyframes toastOut { 
            from { opacity: 1; transform: translateY(0) scale(1); } 
            to { opacity: 0; transform: translateY(-20px) scale(0.9); } 
        }
        
        .toast-icon { 
            font-size: 20px; 
        }
        
        .toast.success { 
            border-right: 4px solid #10b981; 
        }
        
        .toast.success .toast-icon { 
            color: #10b981; 
        }
        
        .toast.error { 
            border-right: 4px solid #ef4444; 
        }
        
        .toast.error .toast-icon { 
            color: #ef4444; 
        }
        
        .toast.warning { 
            border-right: 4px solid #f59e0b; 
        }
        
        .toast.warning .toast-icon { 
            color: #f59e0b; 
        }
        
        .toast.info { 
            border-right: 4px solid #3b82f6; 
        }
        
        .toast.info .toast-icon { 
            color: #3b82f6; 
        }
        
        .toast-content { 
            flex: 1; 
        }
        
        .toast-title { 
            font-size: 14px; 
            color: #2c3e50; 
            margin-bottom: 3px; 
        }
        
        .toast-message { 
            font-size: 12px; 
            color: #64748b; 
        }
        
        .toast-close { 
            background: none; 
            border: none; 
            color: #94a3b8; 
            cursor: pointer; 
            padding: 5px; 
            border-radius: 6px; 
        }
        
        .toast-close:hover { 
            background-color: #f1f5f9; 
        }
        
        /* ====================================================
           Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
        ==================================================== */
        @media (max-width: 768px) {
            .login-box { 
                padding: 30px 20px; 
                margin: 10px; 
            }
            
            .form-row { 
                flex-direction: column; 
                gap: 10px; 
            }
            
            .chats-container { 
                flex-direction: column; 
            }
            
            .chats-sidebar { 
                width: 100%; 
                height: 300px; 
                border-left: none; 
                border-bottom: 1px solid #e0e6ed; 
            }
            
            .summary-cards { 
                grid-template-columns: 1fr; 
            }
            
            .contacts-container { 
                grid-template-columns: 1fr; 
            }
            
            .header-tabs { 
                overflow-x: auto; 
                white-space: nowrap; 
            }
            
            .header-tab { 
                padding: 15px 20px; 
            }
            
            .transactions-table { 
                display: block; 
                overflow-x: auto; 
            }
        }
        
        /* ====================================================
           ÙØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„Ø©
        ==================================================== */
        .offline-data { 
            background-color: #fef3c7; 
            border: 1px solid #fbbf24; 
            border-radius: 10px; 
            padding: 10px 15px; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 13px; 
        }
        
        .offline-data.hidden { 
            display: none; 
        }
        
        /* ====================================================
           Ù…ÙŠØ²Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        ==================================================== */
        .notifications-container { 
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            z-index: 9997; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            align-items: flex-start; 
        }
        
        .notification { 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.15); 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            max-width: 350px; 
            animation: notificationIn 0.3s ease; 
            border-right: 4px solid #3b82f6; 
        }
        
        .notification.transaction { 
            border-right-color: #10b981; 
        }
        
        .notification.chat { 
            border-right-color: #8b5cf6; 
        }
        
        .notification-icon { 
            font-size: 20px; 
        }
        
        .notification.transaction .notification-icon { 
            color: #10b981; 
        }
        
        .notification.chat .notification-icon { 
            color: #8b5cf6; 
        }
        
        .notification-content { 
            flex: 1; 
        }
        
        .notification-title { 
            font-size: 13px; 
            color: #2c3e50; 
            margin-bottom: 3px; 
        }
        
        .notification-message { 
            font-size: 12px; 
            color: #64748b; 
        }
    </style>
</head>
<body>
    <!-- ====================================================
         Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
    ==================================================== -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-title">
                <i class="fas fa-wallet"></i> Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ
            </div>
            <div class="login-subtitle">
                ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙ‚Ø¯Ù… Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ† Ø¨ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯
            </div>
            
            <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø© -->
            <select id="countrySelect" class="country-selector">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©</option>
                <option value="+966">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (+966)</option>
                <option value="+971">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª (+971)</option>
                <option value="+973">ğŸ‡§ğŸ‡­ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† (+973)</option>
                <option value="+974">ğŸ‡¶ğŸ‡¦ Ù‚Ø·Ø± (+974)</option>
                <option value="+968">ğŸ‡´ğŸ‡² Ø¹Ù…Ø§Ù† (+968)</option>
                <option value="+965">ğŸ‡°ğŸ‡¼ Ø§Ù„ÙƒÙˆÙŠØª (+965)</option>
                <option value="+20">ğŸ‡ªğŸ‡¬ Ù…ØµØ± (+20)</option>
                <option value="+962">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù† (+962)</option>
                <option value="+963">ğŸ‡¸ğŸ‡¾ Ø³ÙˆØ±ÙŠØ§ (+963)</option>
                <option value="+964">ğŸ‡®ğŸ‡¶ Ø§Ù„Ø¹Ø±Ø§Ù‚ (+964)</option>
                <option value="+961">ğŸ‡±ğŸ‡§ Ù„Ø¨Ù†Ø§Ù† (+961)</option>
                <option value="+213">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± (+213)</option>
                <option value="+212">ğŸ‡²ğŸ‡¦ Ø§Ù„Ù…ØºØ±Ø¨ (+212)</option>
                <option value="+216">ğŸ‡¹ğŸ‡³ ØªÙˆÙ†Ø³ (+216)</option>
                <option value="+218">ğŸ‡±ğŸ‡¾ Ù„ÙŠØ¨ÙŠØ§ (+218)</option>
                <option value="+967">ğŸ‡¾ğŸ‡ª Ø§Ù„ÙŠÙ…Ù† (+967)</option>
                <option value="+970">ğŸ‡µğŸ‡¸ ÙÙ„Ø³Ø·ÙŠÙ† (+970)</option>
                <option value="+249">ğŸ‡¸ğŸ‡© Ø§Ù„Ø³ÙˆØ¯Ø§Ù† (+249)</option>
                <option value="+252">ğŸ‡¸ğŸ‡´ Ø§Ù„ØµÙˆÙ…Ø§Ù„ (+252)</option>
                <option value="+253">ğŸ‡©ğŸ‡¯ Ø¬ÙŠØ¨ÙˆØªÙŠ (+253)</option>
                <option value="+966">ğŸ‡¸ğŸ‡¦ Ø£Ø®Ø±Ù‰ (+966)</option>
            </select>
            
            <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
            <div class="phone-input-container">
                <div id="countryCodeDisplay" class="country-code">+966</div>
                <input type="tel" id="phoneInput" class="phone-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" maxlength="15">
            </div>
            
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù… -->
            <div id="phoneStatus" class="phone-status"></div>
            
            <!-- Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªÙ„Ø§Ù… OTP -->
            <div id="otpMethodSelector" class="otp-method-selector">
                <div class="otp-method-title">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚:</div>
                <div class="otp-methods">
                    <button id="smsMethod" class="otp-method-btn" onclick="selectOTPMethod('sms')">
                        <i class="fas fa-sms"></i> Ø±Ø³Ø§Ù„Ø© SMS
                    </button>
                    <button id="whatsappMethod" class="otp-method-btn disabled" onclick="selectOTPMethod('whatsapp')" disabled>
                        <i class="fab fa-whatsapp" style="color: #94a3b8;"></i> ÙˆØ§ØªØ³Ø§Ø¨ <small>(Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</small>
                    </button>
                </div>
            </div>
            
            <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ -->
            <div id="otpInputContainer" class="otp-input-container">
                <div class="otp-input-title">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙƒ:</div>
                <input type="text" id="otpInput" class="otp-input" placeholder="Ù€Ù€Ù€ Ù€Ù€Ù€ Ù€Ù€Ù€" maxlength="6">
                <div id="otpError" class="otp-error">Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>
                <div class="otp-resend">
                    Ù„Ù… ØªØ³ØªÙ„Ù… Ø§Ù„Ø±Ù…Ø²ØŸ 
                    <a id="resendOTPLink" onclick="resendOTP()">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„</a>
                    (<span id="resendTimer">60</span> Ø«Ø§Ù†ÙŠØ©)
                </div>
            </div>
            
            <!-- Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <button id="loginActionBtn" class="login-btn" onclick="handleLoginAction()">
                <i class="fas fa-sign-in-alt"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…
            </button>
            
            <button class="back-btn" onclick="showAboutPage()">
                <i class="fas fa-info-circle"></i> Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            </button>
        </div>
    </div>

    <!-- ====================================================
         Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
    ==================================================== -->
    <div id="appContainer" class="app-container">
        <!-- Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div id="syncProgress" class="sync-progress-container">
            <div id="syncProgressBar" class="sync-progress-bar"></div>
        </div>
        
        <!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div id="syncStatusIndicator" class="sync-status-indicator">
            <i class="fas fa-sync-alt"></i>
            <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</span>
        </div>
        
        <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
        <header class="app-header">
            <!-- Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨ -->
            <nav class="header-tabs">
                <button class="header-tab active" onclick="switchTab('transactions')" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i> Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª
                </button>
                <button class="header-tab" onclick="switchTab('chats')" data-tab="chats">
                    <i class="fas fa-comments"></i> Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
                    <span id="unreadChatsBadge" class="tab-badge" style="display: none;">0</span>
                </button>
                <button class="header-tab" onclick="switchTab('contacts')" data-tab="contacts">
                    <i class="fas fa-users"></i> Ø§Ù„Ø¬Ù‡Ø§Øª
                </button>
                <button class="header-tab" onclick="switchTab('stats')" data-tab="stats">
                    <i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
                <button class="header-tab" onclick="switchTab('about')" data-tab="about">
                    <i class="fas fa-info-circle"></i> Ø­ÙˆÙ„
                </button>
            </nav>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
            <div class="header-actions">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="currentUserName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                        <div class="user-phone" id="currentUserPhone">+966 XXX XXX</div>
                    </div>
                </div>
                
                <div class="header-controls">
                    <button class="control-btn sync-btn" onclick="syncData()" title="Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                        <i class="fas fa-sync-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø©
                    </button>
                    <button class="control-btn accounts-btn" onclick="showAccountReport()" title="ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨">
                        <i class="fas fa-file-invoice"></i> ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨
                    </button>
                    <button class="control-btn chat-btn" onclick="startNewChat()" title="Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©">
                        <i class="fas fa-plus"></i> Ø¬Ø¯ÙŠØ¯
                    </button>
                    <button class="control-btn logout-btn" onclick="logout()" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
                        <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </header>

        <!-- ====================================================
             Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        ==================================================== -->
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
        <div id="transactionsTab" class="tab-content active">
            <!-- ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„Ø© -->
            <div id="offlineDataAlert" class="offline-data hidden">
                <i class="fas fa-wifi-slash"></i>
                <span>Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ³ÙŠØªÙ… Ù…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„.</span>
                <button onclick="showOfflineData()" style="margin-right: auto; background: none; border: none; color: #3b82f6; cursor: pointer;">
                    Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                </button>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ØªØ±Ø­ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ -->
            <div class="transaction-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¬Ù‡Ø©</label>
                        <select id="transactionParty" class="form-select">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="transactionDate" class="form-input" value="">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨ÙŠØ§Ù†</label>
                        <input type="text" id="transactionDescription" class="form-input" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                        <select id="transactionCategory" class="form-select">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                            <option value="Ù…Ø´ØªØ±ÙŠØ§Øª">Ù…Ø´ØªØ±ÙŠØ§Øª</option>
                            <option value="Ù…Ø¨ÙŠØ¹Ø§Øª">Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                            <option value="Ø±ÙˆØ§ØªØ¨">Ø±ÙˆØ§ØªØ¨</option>
                            <option value="Ø£Ù‚Ø³Ø§Ø·">Ø£Ù‚Ø³Ø§Ø·</option>
                            <option value="Ù‡Ø¯Ø§ÙŠØ§">Ù‡Ø¯Ø§ÙŠØ§</option>
                            <option value="Ù…ØµØ±ÙˆÙØ§Øª Ø´Ø®ØµÙŠØ©">Ù…ØµØ±ÙˆÙØ§Øª Ø´Ø®ØµÙŠØ©</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="amount-inputs">
                        <div class="amount-input credit">
                            <label class="form-label">Ù„Ù‡ (Ø¥ÙŠØ¯Ø§Ø¹)</label>
                            <input type="number" id="creditAmount" class="form-input" placeholder="0.00" min="0" step="0.01">
                        </div>
                        <div class="amount-input debit">
                            <label class="form-label">Ø¹Ù„ÙŠÙ‡ (Ø³Ø­Ø¨)</label>
                            <input type="number" id="debitAmount" class="form-input" placeholder="0.00" min="0" step="0.01">
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="saveTransactionBtn" class="primary-btn" onclick="saveTransaction()">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠÙ„
                    </button>
                    <button class="secondary-btn" onclick="clearTransactionForm()">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
            
            <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="transaction-summary">
                <div class="summary-cards">
                    <div class="summary-card total-credit">
                        <div class="summary-card-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù‡</div>
                        <div class="summary-card-value" id="totalCreditAmount">0.00</div>
                    </div>
                    <div class="summary-card total-debit">
                        <div class="summary-card-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù„ÙŠÙ‡</div>
                        <div class="summary-card-value" id="totalDebitAmount">0.00</div>
                    </div>
                    <div class="summary-card balance">
                        <div class="summary-card-title">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ</div>
                        <div class="summary-card-value" id="totalBalanceAmount">0.00</div>
                    </div>
                </div>
            </div>
            
            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª -->
            <div class="transactions-table-container">
                <div class="table-header">
                    <div class="table-title">Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" id="transactionsSearch" class="search-input" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <button class="control-btn" onclick="exportTransactions()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                            <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ±
                        </button>
                    </div>
                </div>
                
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø¬Ù‡Ø©</th>
                            <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ù„Ù‡</th>
                            <th>Ø¹Ù„ÙŠÙ‡</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª -->
        <div id="chatsTab" class="tab-content">
            <div class="chats-container">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª -->
                <div class="chats-sidebar">
                    <div class="chats-list" id="chatsList">
                        <!-- Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </div>
                </div>
                
                <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    <div class="chat-welcome" style="text-align: center; margin-top: 100px; color: #94a3b8;">
                        <i class="fas fa-comments fa-3x" style="margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 10px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h3>
                        <p>Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯Ø«</p>
                    </div>
                </div>
                
                <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
                <div class="chat-input-container">
                    <div class="chat-input-row">
                        <textarea id="chatMessageInput" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." rows="2"></textarea>
                        <button id="sendMessageBtn" class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§Øª -->
        <div id="contactsTab" class="tab-content">
            <div class="contacts-container" id="contactsContainer">
                <!-- Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div id="statsTab" class="tab-content">
            <div class="stats-container">
                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
        <div id="aboutTab" class="tab-content">
            <div class="about-container">
                <div class="app-logo">
                    <i class="fas fa-wallet"></i>
                </div>
                <h1 class="app-name">Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ</h1>
                <p class="app-description">
                    ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙ‚Ø¯Ù… Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ† Ø¨ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ© ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©.
                    ØªÙ… ØªØ·ÙˆÙŠØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙŠÙƒÙˆÙ† Ø³Ù‡Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆÙŠØ¹Ù…Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.
                </p>
                
                <div class="developer-info">
                    <h2 class="developer-name">Ø§Ù„Ù…Ø·ÙˆØ±: Ø±Ø¶ÙˆØ§Ù† Ø³Ø±ÙˆØ±ÙŠ</h2>
                    <p class="developer-contact">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: 776100400</p>
                    <p class="developer-contact">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@example.com</p>
                </div>
                
                <div class="app-features">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="feature-title">ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</h3>
                        <p class="feature-description">Ø§Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆÙ…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <h3 class="feature-title">Ù…Ø²Ø§Ù…Ù†Ø© Ø°ÙƒÙŠØ©</h3>
                        <p class="feature-description">Ù…Ø²Ø§Ù…Ù†Ø© Ø«Ù†Ø§Ø¦ÙŠØ© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ù…Ø¹Ù†ÙŠØ©</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="feature-title">Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø¯Ù…Ø¬Ø©</h3>
                        <p class="feature-description">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="feature-title">ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©</h3>
                        <p class="feature-description">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ====================================================
         Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
    ==================================================== -->
    
    <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±Ø­ÙŠÙ„ -->
    <div id="confirmTransactionModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±Ø­ÙŠÙ„</h3>
                <button class="modal-close" onclick="hideModal('confirmTransactionModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±ØŸ</p>
                <div class="transaction-details" style="margin-top: 15px; padding: 15px; background-color: #f8fafc; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ø§Ù„Ø¬Ù‡Ø©:</span>
                        <span id="confirmPartyName"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                        <span id="confirmAmount"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                        <span id="confirmDate"></span>
                    </div>
                </div>
                <p style="margin-top: 15px; color: #3b82f6; font-size: 14px;">
                    <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… Ø¹ÙƒØ³ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                </p>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="hideModal('confirmTransactionModal')">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <button class="primary-btn" onclick="confirmSendTransaction()">
                    <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ -->
    <div id="accountReportModal" class="modal-overlay">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                <button class="modal-close" onclick="hideModal('accountReportModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="account-switcher">
                    <button id="myAccountBtn" class="account-switch-btn active" onclick="switchAccountView('my')">
                        Ø¨ÙŠØ§Ù†Ø§Øª Ø¬ÙˆØ§Ù„ÙŠ
                    </button>
                    <button id="otherAccountBtn" class="account-switch-btn" onclick="switchAccountView('other')">
                        Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
                    </button>
                </div>
                
                <div id="myAccountView" class="account-report">
                    <div class="report-period">
                        Ù…Ù† <span id="reportStartDate">--/--/----</span> Ø¥Ù„Ù‰ <span id="reportEndDate">--/--/----</span>
                    </div>
                    
                    <div class="report-summary">
                        <div class="report-item">
                            <div class="report-item-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
                            <div class="report-item-value" id="reportTotalCredit">0.00</div>
                        </div>
                        <div class="report-item">
                            <div class="report-item-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</div>
                            <div class="report-item-value" id="reportTotalDebit">0.00</div>
                        </div>
                        <div class="report-item">
                            <div class="report-item-title">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                            <div class="report-item-value" id="reportFinalBalance">0.00</div>
                        </div>
                    </div>
                    
                    <div class="report-transactions">
                        <h4 style="margin-bottom: 15px; color: #475569;">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø±ÙƒØ§Øª</h4>
                        <div id="reportTransactionsList">
                            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="otherAccountView" class="account-report" style="display: none;">
                    <div class="report-period">
                        Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù‡Ø§Øª
                    </div>
                    
                    <div id="otherAccountData">
                        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="printAccountReport()">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                </button>
                <button class="primary-btn" onclick="exportAccountReport()">
                    <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ -->
    <div id="addContactModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„</h3>
                <button class="modal-close" onclick="hideModal('addContactModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 20px;">
                    <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="newContactPhone" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù…</label>
                    <input type="text" id="newContactName" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea id="newContactNotes" class="form-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="hideModal('addContactModal')">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <button class="primary-btn" onclick="saveNewContact()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸
                </button>
            </div>
        </div>
    </div>

    <!-- ====================================================
         Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    ==================================================== -->
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
    </div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- ====================================================
         Ø£ÙƒÙˆØ§Ø¯ JavaScript
    ==================================================== -->
    <script>
        // ====================================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        // ====================================================
        const firebaseConfig = {
            apiKey: "AIzaSyARl0bglIAwoXTMBdplPpKhp4bWZ7TiA78",
            authDomain: "rside-almoshtrk.firebaseapp.com",
            projectId: "rside-almoshtrk",
            storageBucket: "rside-almoshtrk.firebasestorage.app",
            messagingSenderId: "943707598004",
            appId: "1:943707598004:web:2dda34c4ba7932051a7be1",
            measurementId: "G-R52FPHV3MY"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // ====================================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Airtable
        // ====================================================
        // ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Ù…ÙØ§ØªÙŠØ­ Airtable Ù‡Ù†Ø§:
        const AIRTABLE_CONFIG = {
            API_TOKEN: 'YOUR_AIRTABLE_API_KEY', // Ø¶Ø¹ API Key Ù‡Ù†Ø§
            BASE_ID: 'YOUR_AIRTABLE_BASE_ID',   // Ø¶Ø¹ Base ID Ù‡Ù†Ø§
            TABLES: {
                TRANSACTIONS: 'YOUR_TABLE_NAME', // Ø¶Ø¹ Table Name Ù‡Ù†Ø§
                USERS: 'tblUsers',
                CHATS: 'tblChats',
                MESSAGES: 'tblMessages'
            }
        };

        // ====================================================
        // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        // ====================================================
        const APP_STATE = {
            currentUser: null,
            isOnline: navigator.onLine,
            isAuthenticated: false,
            pendingSync: [],
            otpMethod: null,
            otpCode: null,
            currentChat: null,
            mirrorTransactions: [],
            offlineData: [],
            unreadMessages: 0,
            firebaseConfirmationResult: null  // Ù„ØªØ®Ø²ÙŠÙ† Ù†ØªÙŠØ¬Ø© ØªØ£ÙƒÙŠØ¯ Firebase
        };

        // ====================================================
        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        // ====================================================
        const LOCAL_STORAGE_KEYS = {
            USER_DATA: 'expense_tracker_user',
            TRANSACTIONS: 'expense_tracker_transactions',
            CONTACTS: 'expense_tracker_contacts',
            CHATS: 'expense_tracker_chats',
            MESSAGES: 'expense_tracker_messages',
            SETTINGS: 'expense_tracker_settings',
            OFFLINE_DATA: 'expense_tracker_offline'
        };

        // ====================================================
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„
        // ====================================================
        const COUNTRIES = [
            { code: '+966', name: 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
            { code: '+971', name: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', flag: 'ğŸ‡¦ğŸ‡ª' },
            { code: '+973', name: 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†', flag: 'ğŸ‡§ğŸ‡­' },
            { code: '+974', name: 'Ù‚Ø·Ø±', flag: 'ğŸ‡¶ğŸ‡¦' },
            { code: '+968', name: 'Ø¹Ù…Ø§Ù†', flag: 'ğŸ‡´ğŸ‡²' },
            { code: '+965', name: 'Ø§Ù„ÙƒÙˆÙŠØª', flag: 'ğŸ‡°ğŸ‡¼' },
            { code: '+20', name: 'Ù…ØµØ±', flag: 'ğŸ‡ªğŸ‡¬' },
            { code: '+962', name: 'Ø§Ù„Ø£Ø±Ø¯Ù†', flag: 'ğŸ‡¯ğŸ‡´' },
            { code: '+963', name: 'Ø³ÙˆØ±ÙŠØ§', flag: 'ğŸ‡¸ğŸ‡¾' },
            { code: '+964', name: 'Ø§Ù„Ø¹Ø±Ø§Ù‚', flag: 'ğŸ‡®ğŸ‡¶' },
            { code: '+961', name: 'Ù„Ø¨Ù†Ø§Ù†', flag: 'ğŸ‡±ğŸ‡§' },
            { code: '+213', name: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', flag: 'ğŸ‡©ğŸ‡¿' },
            { code: '+212', name: 'Ø§Ù„Ù…ØºØ±Ø¨', flag: 'ğŸ‡²ğŸ‡¦' },
            { code: '+216', name: 'ØªÙˆÙ†Ø³', flag: 'ğŸ‡¹ğŸ‡³' },
            { code: '+218', name: 'Ù„ÙŠØ¨ÙŠØ§', flag: 'ğŸ‡±ğŸ‡¾' },
            { code: '+967', name: 'Ø§Ù„ÙŠÙ…Ù†', flag: 'ğŸ‡¾ğŸ‡ª' },
            { code: '+970', name: 'ÙÙ„Ø³Ø·ÙŠÙ†', flag: 'ğŸ‡µğŸ‡¸' },
            { code: '+249', name: 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', flag: 'ğŸ‡¸ğŸ‡©' },
            { code: '+252', name: 'Ø§Ù„ØµÙˆÙ…Ø§Ù„', flag: 'ğŸ‡¸ğŸ‡´' },
            { code: '+253', name: 'Ø¬ÙŠØ¨ÙˆØªÙŠ', flag: 'ğŸ‡©ğŸ‡¯' }
        ];

        // ====================================================
        // ÙØ¦Ø§Øª Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª
        // ====================================================
        const TRANSACTION_CATEGORIES = [
            'Ù…Ø´ØªØ±ÙŠØ§Øª',
            'Ù…Ø¨ÙŠØ¹Ø§Øª',
            'Ø±ÙˆØ§ØªØ¨',
            'Ø£Ù‚Ø³Ø§Ø·',
            'Ù‡Ø¯Ø§ÙŠØ§',
            'Ù…ØµØ±ÙˆÙØ§Øª Ø´Ø®ØµÙŠØ©',
            'ÙÙˆØ§ØªÙŠØ±',
            'ØªØ³Ø¯ÙŠØ¯ Ø¯ÙŠÙˆÙ†',
            'Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª',
            'Ø£Ø®Ø±Ù‰'
        ];

        // ====================================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
        // ====================================================
        function showToast(type, title, message, duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast_' + Date.now();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="${icons[type]} toast-icon"></i>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="removeToast('${toastId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                removeToast(toastId);
            }, duration);
            
            return toastId;
        }

        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.add('hiding');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...') {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            text.textContent = message;
            overlay.classList.add('active');
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('active');
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ar-SA', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num || 0);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function generateTransactionId() {
            return 'TXN_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function generateMessageId() {
            return 'MSG_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function generateUserId(phoneNumber) {
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.random().toString(36).substr(2, 3).toUpperCase();
            return 'USER_' + phoneNumber.replace(/D/g, '').slice(-6) + '_' + timestamp + random;
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ø¹ Firebase
        // ====================================================
        document.getElementById('countrySelect').addEventListener('change', function() {
            const selectedCode = this.value;
            if (selectedCode) {
                document.getElementById('countryCodeDisplay').textContent = selectedCode;
            }
        });

        document.getElementById('phoneInput').addEventListener('input', function() {
            const phone = this.value.trim();
            if (phone.length >= 10) {
                checkPhoneNumber(phone);
            } else {
                document.getElementById('phoneStatus').style.display = 'none';
                document.getElementById('otpMethodSelector').style.display = 'none';
                document.getElementById('otpInputContainer').style.display = 'none';
                updateLoginButton('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…');
            }
        });

        async function checkPhoneNumber(phoneNumber) {
            const countryCode = document.getElementById('countryCodeDisplay').textContent;
            const fullPhone = countryCode + phoneNumber;
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…...');
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Airtable
                const formula = encodeURIComponent(`{PhoneNumber}='${fullPhone}'`);
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.USERS}?filterByFormula=${formula}&maxRecords=1`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    const phoneStatus = document.getElementById('phoneStatus');
                    const otpMethodSelector = document.getElementById('otpMethodSelector');
                    
                    if (data.records.length > 0) {
                        // Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                        phoneStatus.textContent = 'Ø±Ù‚Ù…Ùƒ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.';
                        phoneStatus.className = 'phone-status registered';
                        phoneStatus.style.display = 'block';
                        
                        updateLoginButton('Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚');
                    } else {
                        // Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
                        phoneStatus.textContent = 'Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯. Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù† Ù„Ù„Ø¨Ø¯Ø¡.';
                        phoneStatus.className = 'phone-status new';
                        phoneStatus.style.display = 'block';
                        
                        updateLoginButton('Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯');
                    }
                    
                    otpMethodSelector.style.display = 'block';
                    document.getElementById('otpInputContainer').style.display = 'none';
                    
                } else {
                    throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…');
                }
                
            } catch (error) {
                console.error('Error checking phone:', error);
                showToast('error', 'Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            } finally {
                hideLoading();
            }
        }

        function selectOTPMethod(method) {
            APP_STATE.otpMethod = method;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ø±Ù‚
            document.getElementById('smsMethod').classList.remove('active');
            document.getElementById('whatsappMethod').classList.remove('active');
            
            if (method === 'sms') {
                document.getElementById('smsMethod').classList.add('active');
                updateLoginButton('Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø¹Ø¨Ø± SMS');
            } else if (method === 'whatsapp') {
                document.getElementById('whatsappMethod').classList.add('active');
                updateLoginButton('Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨');
            }
        }

        function updateLoginButton(text) {
            const btn = document.getElementById('loginActionBtn');
            btn.innerHTML = `<i class="fas fa-sign-in-alt"></i> ${text}`;
            
            if (text.includes('Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø²')) {
                btn.onclick = sendOTP;
            } else if (text.includes('Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨')) {
                btn.onclick = registerNewUser;
            } else if (text.includes('Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…')) {
                btn.onclick = checkPhoneNumber.bind(null, document.getElementById('phoneInput').value.trim());
            } else if (text.includes('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')) {
                btn.onclick = verifyOTP;
            }
        }

        async function sendOTP() {
            const phoneInput = document.getElementById('phoneInput');
            const phone = phoneInput.value.trim();
            const countryCode = document.getElementById('countryCodeDisplay').textContent;
            const fullPhone = countryCode + phone;
            
            if (!phone || phone.length < 10) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­');
                return;
            }
            
            if (!APP_STATE.otpMethod) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ù…Ø²');
                return;
            }
            
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù‡ÙŠ SMS ÙÙ‚Ø· (Ù„Ø£Ù† ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø¹Ø¯)
            if (APP_STATE.otpMethod !== 'sms') {
                showToast('error', 'Ø®Ø·Ø£', 'Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± SMS');
                return;
            }
            
            showLoading(`Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø¹Ø¨Ø± SMS...`);
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²
                const recaptchaVerifier = new firebase.auth.RecaptchaVerifier('loginActionBtn', {
                    'size': 'invisible',
                    'callback': function(response) {
                        // reCAPTCHA solved, allow signInWithPhoneNumber.
                    }
                });
                
                const confirmationResult = await auth.signInWithPhoneNumber(fullPhone, recaptchaVerifier);
                APP_STATE.firebaseConfirmationResult = confirmationResult;
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ OTP
                document.getElementById('otpInputContainer').style.display = 'block';
                document.getElementById('otpInput').value = '';
                document.getElementById('otpError').style.display = 'none';
                
                // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                startResendTimer();
                
                updateLoginButton('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                
                showToast('success', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ ${fullPhone}`);
                
            } catch (error) {
                console.error('Error sending OTP:', error);
                let errorMessage = 'ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø². Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                
                if (error.code === 'auth/invalid-phone-number') {
                    errorMessage = 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Ù„Ù‚Ø¯ Ø·Ù„Ø¨Øª Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹';
                }
                
                showToast('error', 'Ø®Ø·Ø£', errorMessage);
            } finally {
                hideLoading();
            }
        }

        function startResendTimer() {
            let timeLeft = 60;
            const timerElement = document.getElementById('resendTimer');
            const resendLink = document.getElementById('resendOTPLink');
            
            resendLink.style.pointerEvents = 'none';
            resendLink.style.color = '#94a3b8';
            
            const timer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    resendLink.style.pointerEvents = 'auto';
                    resendLink.style.color = '#3b82f6';
                    timerElement.textContent = '60';
                }
            }, 1000);
        }

        function resendOTP() {
            sendOTP();
        }

        async function verifyOTP() {
            const enteredOTP = document.getElementById('otpInput').value.trim();
            
            if (!enteredOTP || enteredOTP.length !== 6) {
                document.getElementById('otpError').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…';
                document.getElementById('otpError').style.display = 'block';
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²...');
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
                const credential = await APP_STATE.firebaseConfirmationResult.confirm(enteredOTP);
                const user = credential.user;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† Firebase
                const phoneNumber = user.phoneNumber;
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                await handleUserAfterVerification(phoneNumber);
                
            } catch (error) {
                console.error('Error verifying OTP:', error);
                let errorMessage = 'Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                
                if (error.code === 'auth/invalid-verification-code') {
                    errorMessage = 'Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­';
                } else if (error.code === 'auth/code-expired') {
                    errorMessage = 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø². Ø£Ø±Ø³Ù„ Ø±Ù…Ø²Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹';
                }
                
                document.getElementById('otpError').textContent = errorMessage;
                document.getElementById('otpError').style.display = 'block';
                showToast('error', 'Ø®Ø·Ø£', errorMessage);
            } finally {
                hideLoading();
            }
        }

        async function handleUserAfterVerification(phoneNumber) {
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                const formula = encodeURIComponent(`{PhoneNumber}='${phoneNumber}'`);
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.USERS}?filterByFormula=${formula}`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                let userData;
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.records.length > 0) {
                        // Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯
                        userData = data.records[0].fields;
                        userData.id = data.records[0].id;
                    } else {
                        // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                        userData = await createNewUser(phoneNumber);
                    }
                    
                    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    APP_STATE.currentUser = userData;
                    APP_STATE.isAuthenticated = true;
                    
                    // Ø­ÙØ¸ ÙÙŠ localStorage
                    localStorage.setItem(LOCAL_STORAGE_KEYS.USER_DATA, JSON.stringify(userData));
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    showMainApp();
                    
                    showToast('success', 'Ù…Ø±Ø­Ø¨Ø§Ù‹', `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ ${userData.Name || ''}`);
                    
                } else {
                    throw new Error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
                
            } catch (error) {
                console.error('Error handling user after verification:', error);
                showToast('error', 'Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            } finally {
                hideLoading();
            }
        }

        async function createNewUser(phoneNumber) {
            const userId = generateUserId(phoneNumber);
            
            const userData = {
                UserID: userId,
                PhoneNumber: phoneNumber,
                Name: 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯',
                Country: document.getElementById('countrySelect').options[document.getElementById('countrySelect').selectedIndex].text,
                CreatedAt: new Date().toISOString(),
                LastLogin: new Date().toISOString()
            };
            
            try {
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.USERS}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{
                            fields: userData
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userData.id = data.records[0].id;
                    return userData;
                } else {
                    throw new Error('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
                
            } catch (error) {
                console.error('Error creating user:', error);
                // Ø­ØªÙ‰ Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù†Ø¹ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
                return userData;
            }
        }

        async function registerNewUser() {
            const phoneInput = document.getElementById('phoneInput');
            const phone = phoneInput.value.trim();
            const countryCode = document.getElementById('countryCodeDisplay').textContent;
            const fullPhone = countryCode + phone;
            
            if (!phone || phone.length < 10) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...');
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹
                const formula = encodeURIComponent(`{PhoneNumber}='${fullPhone}'`);
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.USERS}?filterByFormula=${formula}`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.records.length > 0) {
                        showToast('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                        return;
                    }
                    
                    // Ø¥Ø±Ø³Ø§Ù„ OTP Ø¹Ø¨Ø± Firebase
                    selectOTPMethod('sms');
                    await sendOTP();
                    
                } else {
                    throw new Error('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…');
                }
                
            } catch (error) {
                console.error('Error registering user:', error);
                showToast('error', 'Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            } finally {
                hideLoading();
            }
        }

        // ====================================================
        // Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        // ====================================================
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUserInfo();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadUserData();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            startAutoSync();
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            monitorConnection();
        }

        function updateUserInfo() {
            if (APP_STATE.currentUser) {
                document.getElementById('currentUserName').textContent = APP_STATE.currentUser.Name || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('currentUserPhone').textContent = APP_STATE.currentUser.PhoneNumber || '';
            }
        }

        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.header-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            document.querySelector(`.header-tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§ØªØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
            if (tabName === 'chats') {
                loadChats();
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§ØªØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª
            if (tabName === 'contacts') {
                loadContacts();
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            if (tabName === 'stats') {
                loadStatistics();
            }
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
        // ====================================================
        function showSyncProgress(show) {
            const progressContainer = document.getElementById('syncProgress');
            if (show) {
                progressContainer.style.display = 'block';
                updateSyncProgress(0);
            } else {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    updateSyncProgress(0);
                }, 500);
            }
        }

        function updateSyncProgress(percentage) {
            const progressBar = document.getElementById('syncProgressBar');
            progressBar.style.width = percentage + '%';
        }

        function showSyncStatus(message, type = 'syncing') {
            const indicator = document.getElementById('syncStatusIndicator');
            const icon = indicator.querySelector('i');
            const text = indicator.querySelector('span');
            
            indicator.className = `sync-status-indicator ${type}`;
            text.textContent = message;
            
            if (type === 'syncing') {
                icon.className = 'fas fa-sync-alt fa-spin';
            } else if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            }
            
            indicator.classList.add('show');
            
            if (type !== 'syncing') {
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 3000);
            }
        }

        function startAutoSync() {
            // Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                if (APP_STATE.isOnline && APP_STATE.isAuthenticated) {
                    syncData();
                }
            }, 30000);
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø£ÙˆÙ„ÙŠØ©
            setTimeout(() => {
                syncData();
            }, 2000);
        }

        async function syncData() {
            if (!APP_STATE.isOnline) {
                showToast('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                return;
            }
            
            if (!APP_STATE.isAuthenticated) {
                return;
            }
            
            showSyncProgress(true);
            showSyncStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...', 'syncing');
            
            try {
                // 1. Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                await syncLocalTransactions();
                
                // 2. Ø¬Ù„Ø¨ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                await fetchNewTransactions();
                
                // 3. Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
                await syncChats();
                
                // 4. Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¬Ù‡Ø§Øª
                await syncContacts();
                
                showSyncStatus('ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showToast('success', 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                
            } catch (error) {
                console.error('Sync error:', error);
                showSyncStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'error');
                showToast('error', 'Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            } finally {
                showSyncProgress(false);
                updateTransactionSummary();
                renderTransactions();
            }
        }

        async function syncLocalTransactions() {
            const localTransactions = getLocalTransactions();
            const pendingTransactions = localTransactions.filter(t => !t.synced || t.updated);
            
            if (pendingTransactions.length === 0) {
                return;
            }
            
            showSyncStatus(`Ù…Ø²Ø§Ù…Ù†Ø© ${pendingTransactions.length} ØªØ±Ø­ÙŠÙ„...`, 'syncing');
            
            let syncedCount = 0;
            
            for (const transaction of pendingTransactions) {
                try {
                    if (transaction.id && transaction.id.startsWith('TXN_')) {
                        // ØªØ±Ø­ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ - ØªØ­Ø¯ÙŠØ«
                        await updateTransactionInAirtable(transaction);
                    } else {
                        // ØªØ±Ø­ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ - Ø¥Ù†Ø´Ø§Ø¡
                        await createTransactionInAirtable(transaction);
                    }
                    
                    transaction.synced = true;
                    transaction.updated = false;
                    syncedCount++;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                    updateSyncProgress((syncedCount / pendingTransactions.length) * 100);
                    
                } catch (error) {
                    console.error('Error syncing transaction:', error);
                    transaction.syncError = true;
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            saveLocalTransactions(localTransactions);
            
            if (syncedCount > 0) {
                showToast('success', 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', `ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ${syncedCount} ØªØ±Ø­ÙŠÙ„`);
            }
        }

        async function fetchNewTransactions() {
            if (!APP_STATE.currentUser) {
                return;
            }
            
            const lastSync = localStorage.getItem('last_sync_time') || '2000-01-01T00:00:00.000Z';
            
            try {
                const formula = encodeURIComponent(`OR({FromUser}='${APP_STATE.currentUser.UserID}', {ToUser}='${APP_STATE.currentUser.UserID}')`);
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.TRANSACTIONS}?filterByFormula=${formula}&sort[0][field]=CreatedAt&sort[0][direction]=desc`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const localTransactions = getLocalTransactions();
                    
                    let newCount = 0;
                    
                    for (const record of data.records) {
                        const remoteTransaction = record.fields;
                        remoteTransaction.id = record.id;
                        remoteTransaction.synced = true;
                        
                        // Ø§Ù„Ø¨Ø­Ø« Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø­Ù„ÙŠØ§Ù‹
                        const existingIndex = localTransactions.findIndex(t => 
                            t.id === remoteTransaction.id || 
                            t.TransactionID === remoteTransaction.TransactionID
                        );
                        
                        if (existingIndex === -1) {
                            // ØªØ±Ø­ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                            localTransactions.push(remoteTransaction);
                            newCount++;
                            
                            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù…ÙˆØ¬Ù‡ Ø¥Ù„ÙŠÙ†Ø§ØŒ Ù†Ø¶ÙŠÙ Ø¥Ø´Ø¹Ø§Ø±Ø§Ù‹
                            if (remoteTransaction.ToUser === APP_STATE.currentUser.UserID) {
                                showTransactionNotification(remoteTransaction);
                            }
                        } else {
                            // ØªØ­Ø¯ÙŠØ« ØªØ±Ø­ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯
                            localTransactions[existingIndex] = remoteTransaction;
                        }
                    }
                    
                    saveLocalTransactions(localTransactions);
                    
                    if (newCount > 0) {
                        showToast('info', 'ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©', `ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ${newCount} ØªØ±Ø­ÙŠÙ„ Ø¬Ø¯ÙŠØ¯`);
                    }
                    
                    localStorage.setItem('last_sync_time', new Date().toISOString());
                    
                } else {
                    throw new Error('Failed to fetch transactions');
                }
                
            } catch (error) {
                console.error('Error fetching transactions:', error);
            }
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        // ====================================================
        async function loadChats() {
            const chats = getLocalChats();
            const chatsList = document.getElementById('chatsList');
            
            if (chats.length === 0) {
                chatsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                        <i class="fas fa-comments fa-2x" style="margin-bottom: 20px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ø¹Ø¯</p>
                        <button class="primary-btn" onclick="startNewChat()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const chat of chats) {
                const lastMessage = getChatLastMessage(chat.id);
                const unreadCount = getUnreadMessagesCount(chat.id);
                
                html += `
                    <div class="chat-item ${APP_STATE.currentChat === chat.id ? 'active' : ''}" 
                         onclick="openChat('${chat.id}')">
                        <div class="chat-header">
                            <div class="chat-name">${chat.contactName || 'Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„'}</div>
                            <div class="chat-status ${chat.isOnline ? 'online' : 'offline'}">
                                ${chat.isOnline ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}
                            </div>
                        </div>
                        <div class="chat-last-message">
                            ${lastMessage ? (lastMessage.text || 'Ø±Ø³Ø§Ù„Ø©') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„'}
                        </div>
                        ${unreadCount > 0 ? `
                            <div style="margin-top: 5px;">
                                <span class="tab-badge">${unreadCount}</span>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            chatsList.innerHTML = html;
        }

        function openChat(chatId) {
            APP_STATE.currentChat = chatId;
            loadChatMessages(chatId);
            loadChats(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯
        }

        async function loadChatMessages(chatId) {
            const messages = getChatMessages(chatId);
            const chat = getChatById(chatId);
            const chatMessages = document.getElementById('chatMessages');
            
            let html = '';
            
            if (messages.length === 0) {
                html = `
                    <div class="chat-welcome" style="text-align: center; margin-top: 100px; color: #94a3b8;">
                        <i class="fas fa-user-circle fa-3x" style="margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 10px;">${chat.contactName || 'Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„'}</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†</p>
                    </div>
                `;
            } else {
                for (const message of messages) {
                    const isSent = message.senderId === APP_STATE.currentUser.UserID;
                    const isTransaction = message.type === 'transaction';
                    
                    html += `
                        <div class="message ${isSent ? 'sent' : 'received'} ${isTransaction ? 'transaction' : ''}">
                            <div class="message-bubble">
                                ${isTransaction ? `
                                    <div><strong>ØªØ­ÙˆÙŠÙ„ Ù…Ø§Ù„ÙŠ</strong></div>
                                    <div class="transaction-details ${isSent ? '' : 'received'}">
                                        <div>Ø§Ù„Ù…Ø¨Ù„Øº: ${formatNumber(message.amount)}</div>
                                        <div>Ø§Ù„Ø¨ÙŠØ§Ù†: ${message.description || 'Ø¨Ø¯ÙˆÙ† Ø¨ÙŠØ§Ù†'}</div>
                                        <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDate(message.date)}</div>
                                    </div>
                                ` : message.text}
                            </div>
                            <div class="message-time">
                                ${new Date(message.timestamp).toLocaleTimeString('ar-SA', { 
                                    hour: '2-digit', 
                                    minute: '2-digit' 
                                })}
                            </div>
                        </div>
                    `;
                }
            }
            
            chatMessages.innerHTML = html;
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø« Ø±Ø³Ø§Ù„Ø©
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
            markChatAsRead(chatId);
            updateUnreadBadge();
        }

        async function sendMessage() {
            const input = document.getElementById('chatMessageInput');
            const messageText = input.value.trim();
            
            if (!messageText || !APP_STATE.currentChat) {
                return;
            }
            
            const message = {
                id: generateMessageId(),
                chatId: APP_STATE.currentChat,
                senderId: APP_STATE.currentUser.UserID,
                text: messageText,
                type: 'text',
                timestamp: new Date().toISOString(),
                synced: false
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            saveMessage(message);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±Ø§Ù‹
            loadChatMessages(APP_STATE.currentChat);
            
            // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            input.value = '';
            input.style.height = 'auto';
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
            if (APP_STATE.isOnline) {
                try {
                    await syncMessageToAirtable(message);
                    message.synced = true;
                    updateMessage(message);
                } catch (error) {
                    console.error('Error syncing message:', error);
                }
            }
            
            // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± (Ù…Ø­Ø§ÙƒØ§Ø©)
            sendPushNotification(message, APP_STATE.currentChat);
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        // ====================================================
        async function saveTransaction() {
            const party = document.getElementById('transactionParty').value;
            const date = document.getElementById('transactionDate').value;
            const description = document.getElementById('transactionDescription').value.trim();
            const category = document.getElementById('transactionCategory').value;
            const credit = parseFloat(document.getElementById('creditAmount').value) || 0;
            const debit = parseFloat(document.getElementById('debitAmount').value) || 0;
            
            if (!party) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù‡Ø©');
                return;
            }
            
            if (!date) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®');
                return;
            }
            
            if (credit === 0 && debit === 0) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº');
                return;
            }
            
            if (!description) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†');
                return;
            }
            
            const transaction = {
                id: generateTransactionId(),
                TransactionID: generateTransactionId(),
                FromUser: APP_STATE.currentUser.UserID,
                ToUser: party,
                Date: date,
                Description: description,
                Category: category,
                Credit: credit,
                Debit: debit,
                CreatedAt: new Date().toISOString(),
                synced: false,
                mirrorRequired: true
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            const localTransactions = getLocalTransactions();
            localTransactions.push(transaction);
            saveLocalTransactions(localTransactions);
            
            // Ø¹Ø±Ø¶ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
            showTransactionConfirmation(transaction, party);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            renderTransactions();
            updateTransactionSummary();
            clearTransactionForm();
            
            showToast('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function showTransactionConfirmation(transaction, partyId) {
            const contact = getContactById(partyId);
            
            document.getElementById('confirmPartyName').textContent = contact ? contact.name : partyId;
            document.getElementById('confirmAmount').textContent = formatNumber(transaction.Credit || transaction.Debit);
            document.getElementById('confirmDate').textContent = formatDate(transaction.Date);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ§Ù‹
            window.pendingTransaction = transaction;
            
            showModal('confirmTransactionModal');
        }

        async function confirmSendTransaction() {
            const transaction = window.pendingTransaction;
            
            if (!transaction) {
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±Ø­ÙŠÙ„...');
            hideModal('confirmTransactionModal');
            
            try {
                // 1. Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ (ØªÙ… Ø¨Ø§Ù„ÙØ¹Ù„)
                
                // 2. Ø¥Ù†Ø´Ø§Ø¡ ØªØ±Ø­ÙŠÙ„ Ù…Ø¹ÙƒÙˆØ³ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
                const mirrorTransaction = {
                    ...transaction,
                    id: generateTransactionId(),
                    TransactionID: generateTransactionId(),
                    FromUser: transaction.ToUser,
                    ToUser: transaction.FromUser,
                    Credit: transaction.Debit,  // Ø¹ÙƒØ³ Ø§Ù„Ù‚ÙŠÙ…
                    Debit: transaction.Credit,   // Ø¹ÙƒØ³ Ø§Ù„Ù‚ÙŠÙ…
                    Description: `Ù…Ù† ${APP_STATE.currentUser.Name || 'Ù…Ø³ØªØ®Ø¯Ù…'}: ${transaction.Description}`,
                    mirrorOf: transaction.TransactionID,
                    synced: false
                };
                
                // 3. Ø­ÙØ¸ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø¹ÙƒÙˆØ³ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                APP_STATE.mirrorTransactions.push(mirrorTransaction);
                
                // 4. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
                const chatId = getOrCreateChat(transaction.ToUser);
                const message = {
                    id: generateMessageId(),
                    chatId: chatId,
                    senderId: APP_STATE.currentUser.UserID,
                    type: 'transaction',
                    amount: transaction.Credit || transaction.Debit,
                    description: transaction.Description,
                    date: transaction.Date,
                    timestamp: new Date().toISOString(),
                    synced: false
                };
                
                saveMessage(message);
                
                // 5. Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„
                if (APP_STATE.isOnline) {
                    await createTransactionInAirtable(transaction);
                    await createTransactionInAirtable(mirrorTransaction);
                    await syncMessageToAirtable(message);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                    transaction.synced = true;
                    mirrorTransaction.synced = true;
                    message.synced = true;
                    
                    updateLocalTransaction(transaction);
                    updateLocalTransaction(mirrorTransaction);
                    updateMessage(message);
                }
                
                showToast('success', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±');
                
                // 6. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                renderTransactions();
                if (APP_STATE.currentChat === chatId) {
                    loadChatMessages(chatId);
                }
                
            } catch (error) {
                console.error('Error sending transaction:', error);
                showToast('error', 'Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ±Ø­ÙŠÙ„');
            } finally {
                hideLoading();
                delete window.pendingTransaction;
            }
        }

        function renderTransactions() {
            const transactions = getLocalTransactions();
            const searchTerm = document.getElementById('transactionsSearch').value.toLowerCase();
            const tableBody = document.getElementById('transactionsTableBody');
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            const sortedTransactions = [...transactions].sort((a, b) => 
                new Date(b.Date || b.CreatedAt) - new Date(a.Date || a.CreatedAt)
            );
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
            const filteredTransactions = sortedTransactions.filter(t => 
                !searchTerm || 
                (t.Description || '').toLowerCase().includes(searchTerm) ||
                (t.Category || '').toLowerCase().includes(searchTerm) ||
                (t.ToUser || '').toLowerCase().includes(searchTerm)
            );
            
            let html = '';
            
            if (filteredTransactions.length === 0) {
                html = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #94a3b8;">
                            <i class="fas fa-exchange-alt fa-2x" style="margin-bottom: 20px;"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø­ÙŠÙ„Ø§Øª</p>
                        </td>
                    </tr>
                `;
            } else {
                for (const transaction of filteredTransactions) {
                    const isCredit = transaction.Credit > 0;
                    const contact = getContactById(transaction.ToUser);
                    const partyName = contact ? contact.name : transaction.ToUser;
                    
                    html += `
                        <tr>
                            <td>${formatDate(transaction.Date)}</td>
                            <td>${partyName}</td>
                            <td>${transaction.Description || ''}</td>
                            <td>${transaction.Category || ''}</td>
                            <td style="color: #10b981;">${isCredit ? formatNumber(transaction.Credit) : ''}</td>
                            <td style="color: #ef4444;">${!isCredit ? formatNumber(transaction.Debit) : ''}</td>
                            <td style="font-weight: bold; color: ${isCredit ? '#10b981' : '#ef4444'}">
                                ${isCredit ? '+' : '-'}${formatNumber(isCredit ? transaction.Credit : transaction.Debit)}
                            </td>
                            <td>
                                <span class="transaction-type ${isCredit ? 'credit' : 'debit'}">
                                    ${transaction.synced ? 'Ù…Ø²Ø§Ù…Ù†' : 'Ù…Ø­Ù„ÙŠ'}
                                </span>
                            </td>
                            <td>
                                <div class="transaction-actions">
                                    <button class="action-btn chat-btn" onclick="chatAboutTransaction('${transaction.id}')" title="Ù…Ø­Ø§Ø¯Ø«Ø©">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                    <button class="action-btn edit-btn" onclick="editTransaction('${transaction.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete-btn" onclick="deleteTransaction('${transaction.id}')" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }
            
            tableBody.innerHTML = html;
        }

        function updateTransactionSummary() {
            const transactions = getLocalTransactions();
            
            let totalCredit = 0;
            let totalDebit = 0;
            
            for (const transaction of transactions) {
                totalCredit += parseFloat(transaction.Credit) || 0;
                totalDebit += parseFloat(transaction.Debit) || 0;
            }
            
            const totalBalance = totalCredit - totalDebit;
            
            document.getElementById('totalCreditAmount').textContent = formatNumber(totalCredit);
            document.getElementById('totalDebitAmount').textContent = formatNumber(totalDebit);
            document.getElementById('totalBalanceAmount').textContent = formatNumber(totalBalance);
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ù‡Ø§Øª ÙˆØ§Ù„Ø§ØªØµØ§Ù„Ø§Øª
        // ====================================================
        function loadContacts() {
            const contacts = getLocalContacts();
            const container = document.getElementById('contactsContainer');
            
            if (contacts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #94a3b8; width: 100%;">
                        <i class="fas fa-users fa-2x" style="margin-bottom: 20px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„</p>
                        <button class="primary-btn" onclick="showModal('addContactModal')" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const contact of contacts) {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù‡Ø©
                const transactions = getTransactionsWithContact(contact.id);
                let balance = 0;
                
                for (const transaction of transactions) {
                    if (transaction.FromUser === APP_STATE.currentUser.UserID && transaction.ToUser === contact.id) {
                        balance -= transaction.Debit || 0;
                        balance += transaction.Credit || 0;
                    } else if (transaction.ToUser === APP_STATE.currentUser.UserID && transaction.FromUser === contact.id) {
                        balance += transaction.Debit || 0;
                        balance -= transaction.Credit || 0;
                    }
                }
                
                html += `
                    <div class="contact-card">
                        <div class="contact-header">
                            <div class="contact-name">${contact.name}</div>
                            <div class="contact-code" onclick="copyToClipboard('${contact.id}')">
                                ${contact.id}
                            </div>
                        </div>
                        <div class="contact-details">
                            <div class="contact-detail">
                                <span class="contact-detail-label">Ø§Ù„Ù‡Ø§ØªÙ:</span>
                                <span class="contact-detail-value">${contact.phone}</span>
                            </div>
                            <div class="contact-detail">
                                <span class="contact-detail-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·:</span>
                                <span class="contact-detail-value">${contact.lastActivity ? formatDate(contact.lastActivity) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                            </div>
                        </div>
                        <div class="contact-balance">
                            <div class="balance-row">
                                <span class="balance-label">Ø§Ù„Ø±ØµÙŠØ¯:</span>
                                <span class="balance-value ${balance >= 0 ? 'positive' : 'negative'}">
                                    ${balance >= 0 ? '+' : ''}${formatNumber(balance)}
                                </span>
                            </div>
                            <div class="balance-row">
                                <span class="balance-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:</span>
                                <span class="balance-value">${transactions.length}</span>
                            </div>
                        </div>
                        <div class="contact-actions">
                            <button class="primary-btn" style="flex: 1;" onclick="startChatWithContact('${contact.id}')">
                                <i class="fas fa-comment"></i> Ù…Ø­Ø§Ø¯Ø«Ø©
                            </button>
                            <button class="secondary-btn" onclick="showContactDetails('${contact.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ù‡Ø§Øª ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ±Ø­ÙŠÙ„
            updateTransactionPartyList();
        }

        function updateTransactionPartyList() {
            const contacts = getLocalContacts();
            const select = document.getElementById('transactionParty');
            
            // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            const currentValue = select.value;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©</option>';
            
            for (const contact of contacts) {
                const option = document.createElement('option');
                option.value = contact.id;
                option.textContent = contact.name;
                select.appendChild(option);
            }
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (currentValue && contacts.some(c => c.id === currentValue)) {
                select.value = currentValue;
            }
        }

        async function saveNewContact() {
            const phone = document.getElementById('newContactPhone').value.trim();
            const name = document.getElementById('newContactName').value.trim();
            const notes = document.getElementById('newContactNotes').value.trim();
            
            if (!phone || !name) {
                showToast('error', 'Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø§Ø³Ù…');
                return;
            }
            
            const contact = {
                id: generateUserId(phone),
                phone: phone,
                name: name,
                notes: notes,
                addedAt: new Date().toISOString(),
                lastActivity: new Date().toISOString(),
                synced: false
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            const contacts = getLocalContacts();
            contacts.push(contact);
            saveLocalContacts(contacts);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            hideModal('addContactModal');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadContacts();
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('newContactPhone').value = '';
            document.getElementById('newContactName').value = '';
            document.getElementById('newContactNotes').value = '';
            
            showToast('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
            if (APP_STATE.isOnline) {
                try {
                    await syncContactToAirtable(contact);
                    contact.synced = true;
                    updateLocalContact(contact);
                } catch (error) {
                    console.error('Error syncing contact:', error);
                }
            }
        }

        // ====================================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        // ====================================================
        function loadStatistics() {
            const transactions = getLocalTransactions();
            const statsContainer = document.getElementById('statsTab');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            let totalTransactions = transactions.length;
            let totalAmount = 0;
            let creditCount = 0;
            let debitCount = 0;
            let categories = {};
            let monthlyData = {};
            
            for (const transaction of transactions) {
                const amount = transaction.Credit || transaction.Debit;
                totalAmount += amount;
                
                if (transaction.Credit > 0) {
                    creditCount++;
                } else {
                    debitCount++;
                }
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØ¦Ø§Øª
                const category = transaction.Category || 'Ø£Ø®Ø±Ù‰';
                categories[category] = (categories[category] || 0) + 1;
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ù‡Ø±ÙŠØ©
                const date = new Date(transaction.Date || transaction.CreatedAt);
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = { credit: 0, debit: 0 };
                }
                
                if (transaction.Credit > 0) {
                    monthlyData[monthYear].credit += transaction.Credit;
                } else {
                    monthlyData[monthYear].debit += transaction.Debit;
                }
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-chart-line"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
                    </div>
                    <div class="stat-value">${formatNumber(totalAmount)}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 12px; color: #047857;">Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
                            <div style="font-size: 20px; color: #047857;">${creditCount}</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 12px; color: #991b1b;">Ø³Ø­ÙˆØ¨Ø§Øª</div>
                            <div style="font-size: 20px; color: #991b1b;">${debitCount}</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-tags"></i> Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
                    </div>
                    <div id="categoriesChart" class="stat-chart"></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-calendar-alt"></i> Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ
                    </div>
                    <div id="monthlyChart" class="stat-chart"></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-user-friends"></i> Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Øª
                    </div>
                    <div id="topContactsList" style="margin-top: 15px;"></div>
                </div>
            `;
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø®Ø·Ø·Ø§Øª Ø¨Ø³ÙŠØ·Ø©)
            renderCategoriesChart(categories);
            renderMonthlyChart(monthlyData);
            renderTopContacts();
        }

        // ====================================================
        // ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨
        // ====================================================
        function showAccountReport() {
            loadAccountReportData();
            showModal('accountReportModal');
        }

        function loadAccountReportData() {
            const transactions = getLocalTransactions();
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            let reportCredit = 0;
            let reportDebit = 0;
            let reportTransactions = [];
            
            for (const transaction of transactions) {
                const transDate = new Date(transaction.Date || transaction.CreatedAt);
                
                if (transDate >= firstDay && transDate <= today) {
                    reportCredit += parseFloat(transaction.Credit) || 0;
                    reportDebit += parseFloat(transaction.Debit) || 0;
                    
                    reportTransactions.push({
                        date: transaction.Date,
                        description: transaction.Description,
                        amount: transaction.Credit || transaction.Debit,
                        type: transaction.Credit > 0 ? 'credit' : 'debit'
                    });
                }
            }
            
            const finalBalance = reportCredit - reportDebit;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById('reportStartDate').textContent = formatDate(firstDay);
            document.getElementById('reportEndDate').textContent = formatDate(today);
            document.getElementById('reportTotalCredit').textContent = formatNumber(reportCredit);
            document.getElementById('reportTotalDebit').textContent = formatNumber(reportDebit);
            document.getElementById('reportFinalBalance').textContent = formatNumber(finalBalance);
            
            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ø±ÙƒØ§Øª
            const transactionsList = document.getElementById('reportTransactionsList');
            let html = '';
            
            if (reportTransactions.length === 0) {
                html = '<p style="color: #94a3b8; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø±ÙƒØ§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©</p>';
            } else {
                for (const trans of reportTransactions.slice(0, 10)) {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e6ed;">
                            <div>
                                <div style="font-size: 13px;">${trans.description}</div>
                                <div style="font-size: 11px; color: #94a3b8;">${formatDate(trans.date)}</div>
                            </div>
                            <div style="color: ${trans.type === 'credit' ? '#10b981' : '#ef4444'}; font-weight: bold;">
                                ${trans.type === 'credit' ? '+' : '-'}${formatNumber(trans.amount)}
                            </div>
                        </div>
                    `;
                }
            }
            
            transactionsList.innerHTML = html;
        }

        function switchAccountView(view) {
            document.getElementById('myAccountBtn').classList.toggle('active', view === 'my');
            document.getElementById('otherAccountBtn').classList.toggle('active', view === 'other');
            document.getElementById('myAccountView').style.display = view === 'my' ? 'block' : 'none';
            document.getElementById('otherAccountView').style.display = view === 'other' ? 'block' : 'none';
            
            if (view === 'other') {
                loadOtherAccountData();
            }
        }

        function loadOtherAccountData() {
            const mirrorTransactions = APP_STATE.mirrorTransactions;
            const container = document.getElementById('otherAccountData');
            
            if (mirrorTransactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #94a3b8;">
                        <i class="fas fa-exchange-alt fa-2x" style="margin-bottom: 20px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 12px; color: #047857;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…</div>
                            <div style="font-size: 20px; color: #047857;">${formatNumber(mirrorTransactions.reduce((sum, t) => sum + (t.Credit || 0), 0))}</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 12px; color: #991b1b;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø³Ù„</div>
                            <div style="font-size: 20px; color: #991b1b;">${formatNumber(mirrorTransactions.reduce((sum, t) => sum + (t.Debit || 0), 0))}</div>
                        </div>
                        <div style="background: #eff6ff; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 12px; color: #1d4ed8;">Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª</div>
                            <div style="font-size: 20px; color: #1d4ed8;">${mirrorTransactions.length}</div>
                        </div>
                    </div>
                </div>
                
                <div style="max-height: 300px; overflow-y: auto;">
                    <h4 style="margin-bottom: 15px; color: #475569;">Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h4>
            `;
            
            for (const transaction of mirrorTransactions.slice(0, 20)) {
                const contact = getContactById(transaction.FromUser);
                const isCredit = transaction.Credit > 0;
                
                html += `
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px;">
                        <div>
                            <div style="font-size: 13px; font-weight: bold;">${contact ? contact.name : transaction.FromUser}</div>
                            <div style="font-size: 12px; color: #64748b;">${transaction.Description}</div>
                            <div style="font-size: 11px; color: #94a3b8;">${formatDate(transaction.Date)}</div>
                        </div>
                        <div style="color: ${isCredit ? '#10b981' : '#ef4444'}; font-weight: bold; font-size: 16px;">
                            ${isCredit ? '+' : '-'}${formatNumber(isCredit ? transaction.Credit : transaction.Debit)}
                        </div>
                    </div>
                `;
            }
            
            html += `</div>`;
            
            container.innerHTML = html;
        }

        // ====================================================
        // ÙˆØ¸Ø§Ø¦Ù Airtable
        // ====================================================
        async function createTransactionInAirtable(transaction) {
            try {
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.TRANSACTIONS}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{
                            fields: {
                                TransactionID: transaction.TransactionID,
                                FromUser: transaction.FromUser,
                                ToUser: transaction.ToUser,
                                Date: transaction.Date,
                                Description: transaction.Description,
                                Category: transaction.Category,
                                Credit: transaction.Credit,
                                Debit: transaction.Debit,
                                CreatedAt: transaction.CreatedAt,
                                MirrorOf: transaction.mirrorOf || '',
                                Status: 'active'
                            }
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.records[0].id;
                } else {
                    throw new Error('Failed to create transaction');
                }
                
            } catch (error) {
                console.error('Error creating transaction in Airtable:', error);
                throw error;
            }
        }

        async function updateTransactionInAirtable(transaction) {
            try {
                if (!transaction.id || !transaction.id.startsWith('rec')) {
                    return await createTransactionInAirtable(transaction);
                }
                
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.TRANSACTIONS}/${transaction.id}`;
                
                const response = await fetch(url, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fields: {
                            TransactionID: transaction.TransactionID,
                            FromUser: transaction.FromUser,
                            ToUser: transaction.ToUser,
                            Date: transaction.Date,
                            Description: transaction.Description,
                            Category: transaction.Category,
                            Credit: transaction.Credit,
                            Debit: transaction.Debit,
                            UpdatedAt: new Date().toISOString(),
                            Status: 'active'
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update transaction');
                }
                
            } catch (error) {
                console.error('Error updating transaction in Airtable:', error);
                throw error;
            }
        }

        async function syncContactToAirtable(contact) {
            try {
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.USERS}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{
                            fields: {
                                UserID: contact.id,
                                PhoneNumber: contact.phone,
                                Name: contact.name,
                                Notes: contact.notes,
                                AddedAt: contact.addedAt,
                                LastActivity: contact.lastActivity,
                                Status: 'active'
                            }
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.records[0].id;
                }
                
            } catch (error) {
                console.error('Error syncing contact to Airtable:', error);
                throw error;
            }
        }

        async function syncMessageToAirtable(message) {
            try {
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.BASE_ID}/${AIRTABLE_CONFIG.TABLES.MESSAGES}`;
                
                const fields = {
                    MessageID: message.id,
                    ChatID: message.chatId,
                    SenderID: message.senderId,
                    Timestamp: message.timestamp,
                    Status: 'sent'
                };
                
                if (message.type === 'text') {
                    fields.Text = message.text;
                    fields.Type = 'text';
                } else if (message.type === 'transaction') {
                    fields.Type = 'transaction';
                    fields.TransactionAmount = message.amount;
                    fields.TransactionDescription = message.description;
                    fields.TransactionDate = message.date;
                }
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [{
                            fields: fields
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.records[0].id;
                }
                
            } catch (error) {
                console.error('Error syncing message to Airtable:', error);
                throw error;
            }
        }

        // ====================================================
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        // ====================================================
        function getLocalTransactions() {
            try {
                const data = localStorage.getItem(LOCAL_STORAGE_KEYS.TRANSACTIONS);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Error reading local transactions:', error);
                return [];
            }
        }

        function saveLocalTransactions(transactions) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEYS.TRANSACTIONS, JSON.stringify(transactions));
            } catch (error) {
                console.error('Error saving local transactions:', error);
            }
        }

        function updateLocalTransaction(updatedTransaction) {
            const transactions = getLocalTransactions();
            const index = transactions.findIndex(t => t.id === updatedTransaction.id || t.TransactionID === updatedTransaction.TransactionID);
            
            if (index !== -1) {
                transactions[index] = updatedTransaction;
            } else {
                transactions.push(updatedTransaction);
            }
            
            saveLocalTransactions(transactions);
        }

        function getLocalContacts() {
            try {
                const data = localStorage.getItem(LOCAL_STORAGE_KEYS.CONTACTS);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Error reading local contacts:', error);
                return [];
            }
        }

        function saveLocalContacts(contacts) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEYS.CONTACTS, JSON.stringify(contacts));
            } catch (error) {
                console.error('Error saving local contacts:', error);
            }
        }

        function updateLocalContact(updatedContact) {
            const contacts = getLocalContacts();
            const index = contacts.findIndex(c => c.id === updatedContact.id);
            
            if (index !== -1) {
                contacts[index] = updatedContact;
            } else {
                contacts.push(updatedContact);
            }
            
            saveLocalContacts(contacts);
        }

        function getContactById(contactId) {
            const contacts = getLocalContacts();
            return contacts.find(c => c.id === contactId);
        }

        function getLocalChats() {
            try {
                const data = localStorage.getItem(LOCAL_STORAGE_KEYS.CHATS);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Error reading local chats:', error);
                return [];
            }
        }

        function saveLocalChats(chats) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEYS.CHATS, JSON.stringify(chats));
            } catch (error) {
                console.error('Error saving local chats:', error);
            }
        }

        function getChatById(chatId) {
            const chats = getLocalChats();
            return chats.find(c => c.id === chatId);
        }

        function getOrCreateChat(contactId) {
            const chats = getLocalChats();
            const existingChat = chats.find(c => c.contactId === contactId);
            
            if (existingChat) {
                return existingChat.id;
            }
            
            const contact = getContactById(contactId);
            const newChat = {
                id: 'CHAT_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                contactId: contactId,
                contactName: contact ? contact.name : contactId,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                unreadCount: 0
            };
            
            chats.push(newChat);
            saveLocalChats(chats);
            
            return newChat.id;
        }

        function getChatMessages(chatId) {
            try {
                const key = `${LOCAL_STORAGE_KEYS.MESSAGES}_${chatId}`;
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Error reading chat messages:', error);
                return [];
            }
        }

        function saveMessage(message) {
            const messages = getChatMessages(message.chatId);
            messages.push(message);
            
            const key = `${LOCAL_STORAGE_KEYS.MESSAGES}_${message.chatId}`;
            localStorage.setItem(key, JSON.stringify(messages));
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            updateChatLastActivity(message.chatId, message.timestamp);
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø±Ø³Ù„ Ù„ÙŠØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (message.senderId !== APP_STATE.currentUser.UserID) {
                incrementUnreadCount(message.chatId);
            }
        }

        function updateMessage(updatedMessage) {
            const messages = getChatMessages(updatedMessage.chatId);
            const index = messages.findIndex(m => m.id === updatedMessage.id);
            
            if (index !== -1) {
                messages[index] = updatedMessage;
            }
            
            const key = `${LOCAL_STORAGE_KEYS.MESSAGES}_${updatedMessage.chatId}`;
            localStorage.setItem(key, JSON.stringify(messages));
        }

        function getChatLastMessage(chatId) {
            const messages = getChatMessages(chatId);
            return messages.length > 0 ? messages[messages.length - 1] : null;
        }

        function getUnreadMessagesCount(chatId) {
            const chat = getChatById(chatId);
            return chat ? chat.unreadCount || 0 : 0;
        }

        function incrementUnreadCount(chatId) {
            const chats = getLocalChats();
            const chatIndex = chats.findIndex(c => c.id === chatId);
            
            if (chatIndex !== -1) {
                chats[chatIndex].unreadCount = (chats[chatIndex].unreadCount || 0) + 1;
                chats[chatIndex].updatedAt = new Date().toISOString();
                saveLocalChats(chats);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateUnreadBadge();
            }
        }

        function markChatAsRead(chatId) {
            const chats = getLocalChats();
            const chatIndex = chats.findIndex(c => c.id === chatId);
            
            if (chatIndex !== -1) {
                chats[chatIndex].unreadCount = 0;
                chats[chatIndex].updatedAt = new Date().toISOString();
                saveLocalChats(chats);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateUnreadBadge();
            }
        }

        function updateUnreadBadge() {
            const chats = getLocalChats();
            const totalUnread = chats.reduce((sum, chat) => sum + (chat.unreadCount || 0), 0);
            const badge = document.getElementById('unreadChatsBadge');
            
            if (totalUnread > 0) {
                badge.textContent = totalUnread;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        function updateChatLastActivity(chatId, timestamp) {
            const chats = getLocalChats();
            const chatIndex = chats.findIndex(c => c.id === chatId);
            
            if (chatIndex !== -1) {
                chats[chatIndex].updatedAt = timestamp;
                saveLocalChats(chats);
            }
        }

        function getTransactionsWithContact(contactId) {
            const transactions = getLocalTransactions();
            return transactions.filter(t => 
                t.FromUser === contactId || t.ToUser === contactId
            );
        }

        function loadUserData() {
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userData = localStorage.getItem(LOCAL_STORAGE_KEYS.USER_DATA);
            if (userData) {
                APP_STATE.currentUser = JSON.parse(userData);
                APP_STATE.isAuthenticated = true;
                updateUserInfo();
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
            renderTransactions();
            updateTransactionSummary();
            loadContacts();
        }

        // ====================================================
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
        // ====================================================
        function clearTransactionForm() {
            document.getElementById('transactionDescription').value = '';
            document.getElementById('transactionCategory').value = '';
            document.getElementById('creditAmount').value = '';
            document.getElementById('debitAmount').value = '';
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('success', 'ØªÙ… Ø§Ù„Ù†Ø³Ø®', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function showTransactionNotification(transaction) {
            const notificationsContainer = document.getElementById('notificationsContainer');
            const contact = getContactById(transaction.FromUser);
            
            const notification = document.createElement('div');
            notification.className = 'notification transaction';
            notification.innerHTML = `
                <i class="fas fa-exchange-alt notification-icon"></i>
                <div class="notification-content">
                    <div class="notification-title">ØªØ­ÙˆÙŠÙ„ Ù…Ø§Ù„ÙŠ Ø¬Ø¯ÙŠØ¯</div>
                    <div class="notification-message">
                        ${contact ? contact.name : 'Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„'} - ${formatNumber(transaction.Credit || transaction.Debit)}
                    </div>
                </div>
            `;
            
            notificationsContainer.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        function monitorConnection() {
            window.addEventListener('online', () => {
                APP_STATE.isOnline = true;
                document.getElementById('offlineDataAlert').classList.add('hidden');
                showToast('success', 'ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„', 'Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                
                // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§ØªØµØ§Ù„
                setTimeout(() => syncData(), 1000);
            });
            
            window.addEventListener('offline', () => {
                APP_STATE.isOnline = false;
                document.getElementById('offlineDataAlert').classList.remove('hidden');
                showToast('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
            });
        }

        function showOfflineData() {
            const offlineData = APP_STATE.offlineData;
            let message = `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${offlineData.length} Ø¹Ù†ØµØ±

`;
            
            for (const item of offlineData) {
                message += `â€¢ ${item.type}: ${item.description || item.id}
`;
            }
            
            alert(message);
        }

        function exportTransactions() {
            const transactions = getLocalTransactions();
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `transactions_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ±Ø­ÙŠÙ„Ø§Øª');
        }

        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù„ÙŠØ§Ù‹.')) {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Firebase
                auth.signOut().then(() => {
                    console.log('User signed out from Firebase');
                }).catch((error) => {
                    console.error('Error signing out:', error);
                });
                
                APP_STATE.currentUser = null;
                APP_STATE.isAuthenticated = false;
                APP_STATE.firebaseConfirmationResult = null;
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø®ÙˆÙ„
                document.getElementById('phoneInput').value = '';
                document.getElementById('otpInput').value = '';
                document.getElementById('otpInputContainer').style.display = 'none';
                document.getElementById('otpMethodSelector').style.display = 'none';
                document.getElementById('phoneStatus').style.display = 'none';
                
                showToast('info', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function showAboutPage() {
            // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ¨ÙˆÙŠØ¨ Ø­ÙˆÙ„ØŒ Ù†Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø©
            alert(`Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ

Ø§Ù„Ù…Ø·ÙˆØ±: Ø±Ø¶ÙˆØ§Ù† Ø³Ø±ÙˆØ±ÙŠ
Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: 776100400

ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙ‚Ø¯Ù… Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ† Ø¨ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ© ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©.`);
        }

        // ====================================================
        // Ø±Ø³ÙˆÙ…Ø§Øª Ø¨ÙŠØ§Ù†ÙŠØ© Ø¨Ø³ÙŠØ·Ø© (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©)
        // ====================================================
        function renderCategoriesChart(categories) {
            const container = document.getElementById('categoriesChart');
            if (!container) return;
            
            const total = Object.values(categories).reduce((sum, val) => sum + val, 0);
            let html = '';
            
            for (const [category, count] of Object.entries(categories)) {
                const percentage = ((count / total) * 100).toFixed(1);
                const width = Math.max(10, percentage);
                
                html += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-size: 12px;">${category}</span>
                            <span style="font-size: 12px; color: #64748b;">${percentage}%</span>
                        </div>
                        <div style="height: 8px; background: #e0e6ed; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${width}%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function renderMonthlyChart(monthlyData) {
            const container = document.getElementById('monthlyChart');
            if (!container) return;
            
            const months = Object.keys(monthlyData).sort();
            const maxValue = Math.max(...months.map(m => Math.max(monthlyData[m].credit, monthlyData[m].debit)));
            
            let html = '<div style="display: flex; height: 150px; align-items: flex-end; gap: 10px;">';
            
            for (const month of months.slice(-6)) { // Ø¢Ø®Ø± 6 Ø£Ø´Ù‡Ø±
                const data = monthlyData[month];
                const creditHeight = (data.credit / maxValue) * 100;
                const debitHeight = (data.debit / maxValue) * 100;
                
                html += `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center; height: 100%;">
                        <div style="display: flex; align-items: flex-end; height: 100%; width: 100%; gap: 2px;">
                            <div style="flex: 1; background: #10b981; height: ${creditHeight}%; border-radius: 3px 3px 0 0;"></div>
                            <div style="flex: 1; background: #ef4444; height: ${debitHeight}%; border-radius: 3px 3px 0 0;"></div>
                        </div>
                        <div style="font-size: 10px; color: #64748b; margin-top: 5px; transform: rotate(-45deg);">${month.slice(-2)}/${month.slice(2, 4)}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            
            container.innerHTML = html;
        }

        function renderTopContacts() {
            const container = document.getElementById('topContactsList');
            if (!container) return;
            
            const contacts = getLocalContacts();
            const contactBalances = [];
            
            for (const contact of contacts) {
                const transactions = getTransactionsWithContact(contact.id);
                let balance = 0;
                
                for (const transaction of transactions) {
                    if (transaction.FromUser === APP_STATE.currentUser.UserID && transaction.ToUser === contact.id) {
                        balance -= transaction.Debit || 0;
                        balance += transaction.Credit || 0;
                    } else if (transaction.ToUser === APP_STATE.currentUser.UserID && transaction.FromUser === contact.id) {
                        balance += transaction.Debit || 0;
                        balance -= transaction.Credit || 0;
                    }
                }
                
                contactBalances.push({
                    contact: contact,
                    balance: balance,
                    transactionCount: transactions.length
                });
            }
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ù„Ù„Ø±ØµÙŠØ¯
            contactBalances.sort((a, b) => Math.abs(b.balance) - Math.abs(a.balance));
            
            let html = '';
            
            for (const item of contactBalances.slice(0, 5)) {
                html += `
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px;">
                        <div style="font-size: 13px; font-weight: bold;">${item.contact.name}</div>
                        <div style="color: ${item.balance >= 0 ? '#10b981' : '#ef4444'}; font-size: 13px;">
                            ${formatNumber(item.balance)}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // ====================================================
        // ÙˆØ¸Ø§Ø¦Ù ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© (Ù„Ù„ØªÙˆØ¶ÙŠØ­)
        // ====================================================
        function startNewChat() {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function chatAboutTransaction(transactionId) {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function editTransaction(transactionId) {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function deleteTransaction(transactionId) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø­ÙŠÙ„ØŸ')) {
                showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
            }
        }

        function showContactDetails(contactId) {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function startChatWithContact(contactId) {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function printAccountReport() {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function exportAccountReport() {
            showToast('info', 'Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function sendPushNotification(message, chatId) {
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± - ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            console.log('Push notification sent:', message, 'to chat:', chatId);
        }

        // ====================================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ====================================================
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙ‡ÙŠØ¦Ø© ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            monitorConnection();
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„Ø§Ù‹
            const userData = localStorage.getItem(LOCAL_STORAGE_KEYS.USER_DATA);
            if (userData) {
                APP_STATE.currentUser = JSON.parse(userData);
                APP_STATE.isAuthenticated = true;
                showMainApp();
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('transactionsSearch').addEventListener('input', renderTransactions);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø±ØªÙØ§Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø­Ù‚Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            const chatInput = document.getElementById('chatMessageInput');
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ¬Ø¹Ù„Ù‡ Ø¨Ø§Ù‡Øª Ø§Ù„Ù„ÙˆÙ†
            const whatsappBtn = document.getElementById('whatsappMethod');
            whatsappBtn.classList.add('disabled');
            whatsappBtn.disabled = true;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§ØªØ³Ø§Ø¨
            whatsappBtn.addEventListener('click', function(e) {
                if (this.disabled) {
                    e.preventDefault();
                    showToast('warning', 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'Ø®ÙŠØ§Ø± ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… SMS');
                }
            });
        });

    </script>
</body>
</html>

